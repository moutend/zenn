---
title: "ï¼ˆiOSï¼‰å†™çœŸã‚¢ãƒ—ãƒªã®ã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³ã‚’ç·¨é›†ã™ã‚‹æ–¹æ³•"
emoji: "ğŸ’¨"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [Apple, iOS, Swift, VoiceOver, ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£]
published: false
---
## çµè«–

ãŠæ€¥ãã®æ–¹ã®ãŸã‚çµè«–ã‹ã‚‰ã€‚

- Photosãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã«å†™çœŸã®ã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³ã‚’ç·¨é›†ã™ã‚‹æ©Ÿèƒ½ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
- å†™çœŸã‚¢ãƒ—ãƒªã«ãŠã‘ã‚‹ã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³ã¯EXIFã®Image Descriptionã‚¿ã‚°ã®å€¤ã‚’å‚ç…§ã—ã¦ã„ã¾ã™ã€‚
- Image I/Oãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã‚’åˆ©ç”¨ã—ã¦EXIFã®Image Descriptionã‚¿ã‚°ã®å€¤ã‚’èª­ã¿æ›¸ãã™ã‚‹ã“ã¨ã¯å¯èƒ½ã§ã™ã€‚

## å®Ÿè£…ä¾‹

å‚è€ƒã¾ã§ã«ã€æŒ‡å®šã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã®Image Descriptionã‚’ä¸Šæ›¸ãã™ã‚‹å‡¦ç†ã‚’ç¤ºã—ã¾ã™ã€‚

```swift
import Foundation
import ImageIO
import UniformTypeIdentifiers

func writeExifImageDescription(inputFile: URL, imageDescription: String) {
  guard let source = CGImageSourceCreateWithURL(inputFile as CFURL, nil) else {
    return
  }
  guard let metadata = CGImageSourceCopyPropertiesAtIndex(source, 0, nil) as? [String: Any] else {
    return
  }

  var mutableMetadata = metadata

  if var tiff = mutableMetadata[kCGImagePropertyTIFFDictionary as String] as? [String: Any] {
    tiff[kCGImagePropertyTIFFImageDescription as String] = imageDescription as CFString
    mutableMetadata[kCGImagePropertyTIFFDictionary as String] = tiff
  } else {
    mutableMetadata[kCGImagePropertyTIFFDictionary as String] = [
      kCGImagePropertyTIFFImageDescription as String: imageDescription as CFString
    ]
  }
  guard let cgImage = CGImageSourceCreateImageAtIndex(source, 0, nil) else {
    return
  }

  let typeIdentifier: String
  let fileExtension = inputFile.pathExtension.lowercased()

  if let inputUTI = UTType(filenameExtension: fileExtension)?.identifier {
    typeIdentifier = inputUTI
  } else {
    typeIdentifier = UTType.jpeg.identifier
  }
  guard
    let destination = CGImageDestinationCreateWithURL(
      inputFile as CFURL, typeIdentifier as CFString, 1, nil)
  else {
    return
  }

  CGImageDestinationAddImage(destination, cgImage, mutableMetadata as CFDictionary)
  CGImageDestinationFinalize(destination)
}
```

ä¾‹ãˆã°ã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³ã¤ãã®ç”»åƒã‚’å†™çœŸã‚¢ãƒ—ãƒªã«ä½œæˆã™ã‚‹å ´åˆã€Image Descriptionã‚’æ›¸ãè¾¼ã‚“ã å¾Œã«`PHAssetChangeRequest.creationRequestForAssetFromImage(atFileURL: inputFile)`ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

## ï¼ˆä½™è«‡ï¼‰VoiceOverã‚¹ã‚¯ãƒªãƒ¼ãƒ³ãƒªãƒ¼ãƒ€ãƒ¼ã®æŒ™å‹•

ã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³ã¤ãç”»åƒã‚’`PHAssetChangeRequest.creationRequestForAssetFromImage`çµŒç”±ã§ä½œæˆã™ã‚‹ã¨ã€å†™çœŸã®ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£ãƒ©ãƒ™ãƒ«ã«ãã®å†…å®¹ãŒåæ˜ ã•ã‚Œã¾ã™ã€‚iOS 15ã‹ã‚‰iOS 18ã®å®Ÿæ©Ÿã§ç¢ºèªæ¸ˆã¿ã§ã™ã€‚

ä¸€æ–¹ã€å†™çœŸã‚¢ãƒ—ãƒªã‚’é–‹ãç”»åƒã‚’é¸æŠã—ã¦ã€æƒ…å ±ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰ã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³ã‚’ç·¨é›†ã—ã¦ã‚‚ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£ãƒ©ãƒ™ãƒ«ã«ã¯å†…å®¹ãŒåæ˜ ã•ã‚Œã¾ã›ã‚“ã€‚VoiceOverã¯ã€Œå†™çœŸã€ã¨ã—ã‹èª­ã¿ä¸Šã’ã—ã¾ã›ã‚“ã€‚

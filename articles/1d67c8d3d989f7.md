---
title: "åŒã˜æŒ‡ç¤ºã§ã©ã‚Œã ã‘ã®å·®ãŒå‡ºã‚‹ã‹"
emoji: "ðŸŒŸ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: []
published: false
---
## ã¯ã˜ã‚ã«

å·®ãŒç”Ÿã˜ãŸå ´åˆã®å†ç¾ã™ã‚‹æœ€å°ã®æŒ‡ç¤º

### æŒ‡ç¤º1

ä»¥ä¸‹ã®Swiftã‚³ãƒ¼ãƒ‰ã¯Taskã®å®Œäº†ã‚’å¾…æ©Ÿã—ã¦ã„ãªã„ãŸã‚ã€`swift main.swift`ã‚³ãƒžãƒ³ãƒ‰ã®å®Ÿè¡Œå¾Œã«ã¯ä½•ã‚‚è¡¨ç¤ºã•ã‚Œã¾ã›ã‚“ã€‚ã“ã®ã‚³ãƒ¼ãƒ‰ãŒãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®è¡¨ç¤ºã‚’è¡Œãˆã‚‹ã‚ˆã†ã«ä¿®æ­£ã—ã¦ãã ã•ã„ã€‚

```console
$ cat > main.swift <<-EOF
import Foundation

func hello() async {
  print("Hello, World!")
}

Task {
  try? await Task.sleep(nanoseconds: 1_000_000_000)
  await hello()
}
EOF

# å®Ÿè¡Œã™ã‚‹ã¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œãšã™ãã«çµ‚äº†ã—ã¦ã—ã¾ã†ã€‚
$ swift main.swift
```

#### Claude 3.7 Sonnetã®å›žç­”

:::details Claude 3.7 Sonnetã®å›žç­”

ã‚³ãƒ¼ãƒ‰ã®å•é¡Œã¯ã€ãƒ¡ã‚¤ãƒ³ã‚¹ãƒ¬ãƒƒãƒ‰ãŒTaskã®å®Œäº†ã‚’å¾…æ©Ÿã›ãšã«çµ‚äº†ã—ã¦ã—ã¾ã£ã¦ã„ã‚‹ã“ã¨ã§ã™ã­ã€‚TaskãŒå®Œäº†ã™ã‚‹å‰ã«ãƒ—ãƒ­ã‚°ãƒ©ãƒ ãŒçµ‚äº†ã™ã‚‹ãŸã‚ã€ã€ŒHello, World!ã€ãŒè¡¨ç¤ºã•ã‚Œã¾ã›ã‚“ã€‚  
ã“ã®å•é¡Œã‚’è§£æ±ºã™ã‚‹ã«ã¯ã€ãƒ¡ã‚¤ãƒ³ã‚¹ãƒ¬ãƒƒãƒ‰ãŒTaskã®å®Œäº†ã‚’å¾…æ©Ÿã™ã‚‹ã‚ˆã†ã«ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ä»¥ä¸‹ã®ã‚ˆã†ã«ä¿®æ­£ã—ã¾ã—ã‚‡ã†ï¼š  

Taskã®å®Œäº†ã‚’å¾…æ©Ÿã™ã‚‹Swiftã‚³ãƒ¼ãƒ‰

```swift
import Foundation

func hello() async {
  print("Hello, World!")
}

// ãƒ¡ã‚¤ãƒ³ã®éžåŒæœŸé–¢æ•°ã‚’ä½œæˆ
@main
struct Main {
  static func main() async throws {
    // éžåŒæœŸã‚¿ã‚¹ã‚¯ã‚’ä½œæˆã—ã€ãã®å®Œäº†ã‚’å¾…æ©Ÿ
    try await Task.sleep(nanoseconds: 1_000_000_000)
    await hello()
  }
}
```

ã“ã®ä¿®æ­£ã§ã¯ä»¥ä¸‹ã®å¤‰æ›´ã‚’è¡Œã„ã¾ã—ãŸï¼š

- @mainå±žæ€§ã‚’æŒã¤Mainæ§‹é€ ä½“ã‚’è¿½åŠ ã—ã€Swift 5.5ä»¥é™ã§åˆ©ç”¨å¯èƒ½ãªéžåŒæœŸã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™
- static func main() async throwsãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®Ÿè£…ã—ã€ã“ã‚ŒãŒãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆã«ãªã‚Šã¾ã™
- éžåŒæœŸå‡¦ç†ã‚’ç›´æŽ¥ã“ã®ãƒ¡ã‚½ãƒƒãƒ‰å†…ã§å®Ÿè¡Œã—ã€try awaitã‚’ä½¿ã£ã¦å®Œäº†ã‚’å¾…æ©Ÿã—ã¦ã„ã¾ã™

ã“ã‚Œã«ã‚ˆã‚Šã€ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã¯TaskãŒå®Œäº†ã—ã€ã€ŒHello, World!ã€ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã¾ã§ãƒ¡ã‚¤ãƒ³ã‚¹ãƒ¬ãƒƒãƒ‰ãŒçµ‚äº†ã—ãªããªã‚Šã¾ã™ã€‚  
åˆ¥ã®è§£æ±ºæ–¹æ³•ã¨ã—ã¦ã¯ã€DispatchSemaphoreã‚’ä½¿ç”¨ã™ã‚‹æ–¹æ³•ã‚‚ã‚ã‚Šã¾ã™ï¼š  

```swift
import Foundation

func hello() async {
  print("Hello, World!")
}

// ã‚»ãƒžãƒ•ã‚©ã‚’ä½œæˆ
let semaphore = DispatchSemaphore(value: 0)

Task {
  try? await Task.sleep(nanoseconds: 1_000_000_000)
  await hello()
  semaphore.signal() // ã‚¿ã‚¹ã‚¯å®Œäº†ã‚’é€šçŸ¥
}

// ãƒ¡ã‚¤ãƒ³ã‚¹ãƒ¬ãƒƒãƒ‰ã‚’ãƒ–ãƒ­ãƒƒã‚¯ã—ã¦ã‚¿ã‚¹ã‚¯ã®å®Œäº†ã‚’å¾…æ©Ÿ
semaphore.wait()
```

ã©ã¡ã‚‰ã®æ–¹æ³•ã§ã‚‚ã€ã€ŒHello, World!ã€ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚  

:::

### Gemini 2.5 Pro

ã”æŒ‡æ‘˜ã®é€šã‚Šã€ç¾åœ¨ã®ã‚³ãƒ¼ãƒ‰ã§ã¯ Task ã§é–‹å§‹ã•ã‚ŒãŸéžåŒæœŸå‡¦ç†ãŒå®Œäº†ã™ã‚‹å‰ã«ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®ãƒ¡ã‚¤ãƒ³ã‚¹ãƒ¬ãƒƒãƒ‰ãŒçµ‚äº†ã—ã¦ã—ã¾ã†ãŸã‚ã€"Hello, World!" ãŒè¡¨ç¤ºã•ã‚Œã¾ã›ã‚“ã€‚  
ã“ã®å•é¡Œã‚’è§£æ±ºã™ã‚‹ã«ã¯ã€Swift 5.5 ã§å°Žå…¥ã•ã‚ŒãŸ @main ã‚¢ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ãƒˆã‚’ä½¿ç”¨ã™ã‚‹ã®ãŒæœ€ã‚‚ç¾ä»£çš„ã§æŽ¨å¥¨ã•ã‚Œã‚‹æ–¹æ³•ã§ã™ã€‚@main ã‚’æ§‹é€ ä½“ã‚„ã‚¯ãƒ©ã‚¹ã«ä»˜ä¸Žã—ã€ãã®ä¸­ã« async static func main() ã‚’å®šç¾©ã™ã‚‹ã“ã¨ã§ã€ãƒˆãƒƒãƒ—ãƒ¬ãƒ™ãƒ«ã®ã‚³ãƒ¼ãƒ‰ã§ await ã‚’ä½¿ç”¨ã§ãã€éžåŒæœŸå‡¦ç†ã®å®Œäº†ã‚’ãƒ—ãƒ­ã‚°ãƒ©ãƒ ãŒè‡ªå‹•çš„ã«å¾…æ©Ÿã™ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚  
ä»¥ä¸‹ã®ã‚ˆã†ã«ã‚³ãƒ¼ãƒ‰ã‚’ä¿®æ­£ã—ã¦ãã ã•ã„ã€‚  

```swift
import Foundation

// @main ã‚¢ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ãƒˆã‚’ä»˜ã‘ãŸæ§‹é€ ä½“ã‚’å®šç¾©
@main
struct MyProgram {
    // éžåŒæœŸå‡¦ç†ã‚’å®Ÿè¡Œã™ã‚‹ static async main é–¢æ•°ã‚’å®šç¾©
    static func main() async throws { // Task.sleepãŒã‚¨ãƒ©ãƒ¼ã‚’æŠ•ã’ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ã®ã§ throws ã‚’è¿½åŠ 
        func hello() async {
          print("Hello, World!")
        }
        // 1ç§’å¾…æ©Ÿ (Taskã§å›²ã‚€å¿…è¦ã¯ãªãã€ç›´æŽ¥ await ã§ãã‚‹)
        try await Task.sleep(nanoseconds: 1_000_000_000)
        // helloé–¢æ•°ã‚’å‘¼ã³å‡ºã™
        await hello()
    }
}
```

ä¿®æ­£å¾Œã®ã‚³ãƒ¼ãƒ‰ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã—ã¦å®Ÿè¡Œã™ã‚‹ä¾‹:

```console
# ä¿®æ­£å¾Œã®ã‚³ãƒ¼ãƒ‰ã‚’ main.swift ã«ä¿å­˜
$ cat > main.swift <<-EOF
import Foundation
@main
struct MyProgram {
    static func main() async throws {
        func hello() async {
          print("Hello, World!")
        }
        try await Task.sleep(nanoseconds: 1_000_000_000)
        await hello()
    }
}
EOF
# å®Ÿè¡Œã™ã‚‹ã¨ã€1ç§’å¾Œã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚‹
$ swift main.swift
Hello, World!
```

è§£èª¬:

- @main ã‚¢ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ãƒˆã‚’ MyProgram æ§‹é€ ä½“ã«ä»˜ä¸Žã—ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ã“ã®æ§‹é€ ä½“ã® main() é–¢æ•°ãŒãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆï¼ˆé–‹å§‹ç‚¹ï¼‰ã¨ã—ã¦æ‰±ã‚ã‚Œã¾ã™ã€‚
- static func main() ã‚’ async ã¨ã—ã¦å®šç¾©ã—ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€main é–¢æ•°å†…ã§ await ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’ä½¿ã£ã¦éžåŒæœŸå‡¦ç†ã‚’å¾…æ©Ÿã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚
- å…ƒã®ã‚³ãƒ¼ãƒ‰ã® Task { ... } å†…ã«ã‚ã£ãŸå‡¦ç†ã‚’ async static func main() å†…ã«ç›´æŽ¥è¨˜è¿°ã—ã¾ã™ã€‚
- Task.sleep(nanoseconds:) ã¯ã‚¨ãƒ©ãƒ¼ã‚’æŠ•ã’ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ãŸã‚ã€try await ã‚’ä½¿ç”¨ã—ã€main é–¢æ•°ã« throws ã‚’è¿½åŠ ã—ã¾ã™ã€‚
- await hello() ã§ hello é–¢æ•°ã®å®Œäº†ã‚’å¾…ã¡ã¾ã™ã€‚
- async static func main() å†…ã®ã™ã¹ã¦ã® await å‡¦ç†ãŒå®Œäº†ã™ã‚‹ã¾ã§ã€ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã¯çµ‚äº†ã›ãšã«å¾…æ©Ÿã—ã¾ã™ã€‚

ã“ã®ä¿®æ­£ã«ã‚ˆã‚Šã€Task.sleep ã§1ç§’å¾…æ©Ÿã—ãŸå¾Œã€hello é–¢æ•°ãŒå®Ÿè¡Œã•ã‚Œã€"Hello, World!" ãŒã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«è¡¨ç¤ºã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

---
title: "Dockerã®amazon/aws-cliã§SessionManagerPlugin is not foundã‚¨ãƒ©ãƒ¼ã‚’å›é¿ã™ã‚‹æ–¹æ³•"
emoji: "ğŸ˜½"
type: "tech"
topics: [AWS CLI EC2 docker macOS]
published: true
---
# ã¯ã˜ã‚ã«

ä»¥ä¸‹ã®ç’°å¢ƒã§å‹•ä½œæ¤œè¨¼ã—ã¾ã—ãŸã€‚

- ãƒ›ã‚¹ãƒˆãƒã‚·ãƒ³ã¯arm64ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®MacBook Pro
- Docker Desktop for macOS 4.12.0 (85629)
- Docker version 20.10.17, build 100c701

# å•é¡Œ

EC2ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«æ¥ç¶šã™ã‚‹ã«ã¯`aws ssm`ã‚³ãƒãƒ³ãƒ‰ã‚’åˆ©ç”¨ã™ã‚Œã°è‰¯ã„ãã†ã§ã™ã€‚ã—ã‹ã—ã€ãƒ„ãƒ¼ãƒ«ã‚’ã‚ã‚Œã“ã‚Œã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ãƒ›ã‚¹ãƒˆãƒã‚·ãƒ³ã®ç’°å¢ƒã‚’æ•£ã‚‰ã‹ã™ã®ã¯é¿ã‘ãŸã„ã¨ã“ã‚ã€‚

å¹¸ã„ã€amazonå…¬å¼ã®Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ã¨ã—ã¦amazon/aws-cliãŒæä¾›ã•ã‚Œã¦ã„ã¾ã™ã€‚ã“ã‚Œã‚’ä½¿ã„ã¾ã—ã‚‡ã†ã€‚

```console
$ docker run --rm -it -v "$HOME/.aws:/root/.aws" amazon/aws-cli \
  ssm start-session --target "${ec2_instance_id}"
```

ä¸Šè¨˜ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

```console
...
SessionManagerPlugin is not found. Please refer to SessionManager Documentation here: http://docs.aws.amazon.com/console/systems-manager/session-manager-plugin-not-found
```

ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸï¼ï¼ï¼

# è§£æ±ºç­–

Session Manager Pluginã‚’è¿½åŠ ã—ãŸã‚«ã‚¹ã‚¿ãƒ ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä½œæˆã—ã¾ã™ã€‚ä»¥ä¸‹ã®å†…å®¹ã§Dockerfileã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚

```dockerfile
FROM amazon/aws-cli

RUN curl "https://s3.amazonaws.com/session-manager-downloads/plugin/latest/linux_arm64/session-manager-plugin.rpm" \
  -o session-manager-plugin.rpm \
  && yum install -y ./session-manager-plugin.rpm
```

ï¼ˆæ³¨æ„ï¼‰ä¸Šè¨˜ã¯arm64ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®MacBook Proã§å®Ÿè¡Œã™ã‚‹æƒ³å®šã®Dockerfileã§ã™ã€‚ãƒ›ã‚¹ãƒˆãƒã‚·ãƒ³ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã«å¿œã˜ã¦curlã«æ¸¡ã™URLã‚’é¸ã‚“ã§ãã ã•ã„ã€‚

- x86â†’`curl "https://s3.amazonaws.com/session-manager-downloads/plugin/latest/linux_32bit/session-manager-plugin.rpm" -o "session-manager-plugin.rpm"`
- x86_64â†’`curl "https://s3.amazonaws.com/session-manager-downloads/plugin/latest/linux_64bit/session-manager-plugin.rpm" -o "session-manager-plugin.rpm"`
- arm64â†’`curl "https://s3.amazonaws.com/session-manager-downloads/plugin/latest/linux_arm64/session-manager-plugin.rpm" -o "session-manager-plugin.rpm"`

è©³ç´°ã«ã¤ã„ã¦ã¯[å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://docs.aws.amazon.com/systems-manager/latest/userguide/session-manager-working-with-install-plugin.html#install-plugin-linux)ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

Dockerfileã‚’ä½œæˆã—ãŸã‚‰ã€ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ“ãƒ«ãƒ‰ã—ã¾ã™ã€‚åå‰ã¯`aws-cli-with-session-manager-plugin`ã¨ã—ã¾ã™ã€‚

```console
$ docker build -t aws-cli-with-session-manager-plugin .
```

å†’é ­ã®ã‚³ãƒãƒ³ãƒ‰ã®`amazon/aws-cli`ã‚’`aws-cli-with-session-manager-plugin`ã«ç½®ãæ›ãˆã¾ã™ã€‚ã“ã‚Œã§EC2ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«æ¥ç¶šã§ãã¾ã™ã€‚

```console
$ docker run --rm -it -v "$HOME/.aws:/root/.aws" aws-cli-with-session-manager-plugin \
  ssm start-session --target "${ec2_instance_id}"
```

ä»¥ä¸‹ã®ã‚ˆã†ã«ã‚·ã‚§ãƒ«ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãŒè¡¨ç¤ºã•ã‚ŒãŸã‚‰æˆåŠŸã§ã™ã€‚

```console
...
Starting session with SessionId: koyanagi-admin-03166c27c3a31abea
sh-4.2$
```

# å‚è€ƒè³‡æ–™

1. [Include SessionManagerPlugin in Docker image - Issue #5373 - aws/aws-cli](https://github.com/aws/aws-cli/issues/5373)
2. [(Optional) Install the Session Manager plugin for the AWS CLI - AWS Systems Manager](https://docs.aws.amazon.com/systems-manager/latest/userguide/session-manager-working-with-install-plugin.html#install-plugin-linux)

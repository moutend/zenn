---
title: "[iOS] AVAudioPlayerNodeã‹ã‚‰éŸ³å£°ãŒå†ç”Ÿã•ã‚Œãªã„å ´åˆã®å¯¾å‡¦æ³•"
emoji: "ğŸ•Œ"
type: "tech"
topics: [iOS AVFoundation AVAudioPlayerNode AVAudioEngine éŸ³å£°ä¿¡å·å‡¦ç†]
published: false
---
# ã¯ã˜ã‚ã«

ä»¥ä¸‹ã®é–‹ç™ºç’°å¢ƒã§å‹•ä½œæ¤œè¨¼ã—ã¾ã—ãŸã€‚

- macOS Big Sur 11.3.1
- Xcode 12.5 (12E262)
- iOS 14.5.1

ã“ã®è¨˜äº‹ã§ã¯Startãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨5ç§’é–“ãƒ›ãƒ¯ã‚¤ãƒˆãƒã‚¤ã‚ºãŒå†ç”Ÿã•ã‚Œã‚‹å‡¦ç†ã‚’ä¾‹ã«èª¬æ˜ã—ã¾ã™ã€‚éŸ³é‡ã«ã”æ³¨æ„ãã ã•ã„ã€‚

# ä¿®æ­£å‰

ä»¥ä¸‹ã®å®Ÿè£…ã§ã¯Startãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ã‚‚éŸ³å£°ãŒå†ç”Ÿã•ã‚Œã¾ã›ã‚“ã€‚

```swift

```

è©³ã—ãèª¬æ˜ã™ã‚‹ã¨ã€ä¸Šè¨˜ã®å®Ÿè£…ã§ã¯AVAudioEngineã¯å‹•ä½œã—ã¦ã„ã‚‹ã®ã«AVAudioPlayerNodeã¯ãƒãƒƒãƒ•ã‚¡ã«ä¿¡å·ã‚’æ›¸ãè¾¼ã¿ã¾ã›ã‚“ã€‚

# ä¿®æ­£å¾Œ

```swift
import AVFoundation
import SwiftUI

struct ContentView: View {
    var engine: AVAudioEngine
    var playerNode: AVAudioPlayerNode

    var body: some View {
        Button("Start") {
            if self.engine.isRunning {
                return
            }
            do {
                try self.engine.start()
            } catch {
                print(error)
            }

            self.playerNode.play()
        }
    }
    init() {
        self.engine = AVAudioEngine()
        self.playerNode = AVAudioPlayerNode()

        let outputFormat = self.engine.outputNode.inputFormat(forBus: 0)
        let bufferFrameLength = AVAudioFrameCount(outputFormat.sampleRate * 5)
        let buffer = AVAudioPCMBuffer(pcmFormat: outputFormat, frameCapacity: bufferFrameLength)!

        guard let floatChannelData = buffer.floatChannelData else {
            fatalError("failed to obtain underlying input buffer")
        }
        for channel in 0 ..< Int(buffer.format.channelCount) {
            let p: UnsafeMutablePointer<Float> = floatChannelData[channel]

            for i in 0 ..< Int(bufferFrameLength) {
                p[i] = Float.random(in: -1.0 ... 1.0)
            }
        }

        buffer.frameLength = bufferFrameLength

        self.engine.attach(self.playerNode)
        self.engine.connect(self.playerNode, to: self.engine.outputNode, format: outputFormat)

        self.playerNode.scheduleBuffer(buffer) {
            print("do something after playback ends")
        }
    }
}

struct ContentView_Previews: PreviewProvider {
    static var previews: some View {
        ContentView()
    }
}
```

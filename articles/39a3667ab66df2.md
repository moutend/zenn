---
title: "（macOS）AVSpeechSynthesizerの読み上げ速度は0.0から1.0の範囲で指定できるとは限らない"
emoji: "🐕"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: [Apple, macOS, Swift, AVSpeechSynthesizer]
published: false
---
## はじめに

macOSについての話題です。お急ぎの方のため結論から。

- AVSpeechSynthesizerの読み上げ音声はAVSpeechUtteranceで調整できます。
- AVSpeechUtteranceにはrateプロパティがあり、読み上げの速度を設定できます。
- rateの値として設定可能な範囲は以下の定数として宣言されています。
    - 最小値: `let AVSpeechUtteranceMinimumSpeechRate = 0.0`
    - 最大値: `let AVSpeechUtteranceMaximumSpeechRate = 1.0`
    - ほとんどの音声は0.0から1.0の範囲で正規化されていると考えて差し支えありません。
- しかし、音声によっては1.0より大きい値を設定できたり、最大値が1.0未満の場合があります。
    - 例: en-US Alex (Enhanced) の読み上げ速度は3.0まで設定できる。
    - 例: ja-JP Granmaの読み上げ速度は0.5が最大値であり、それ以上の値は設定しても無視される。
- macOS 12 Monterey以前のバージョンでは最大値が1.0未満の音声がある。
    - 例: en-US Samanthaの最大値は0.89
    - 例: ja-JP Kyokoの最大値は0.89

## サンプルアプリ

今回の事象を再現するためのサンプルアプリを作成しました。macOS 12 Monterey以上のmacOSで動作します。

https://github.com/moutend/MacAVSpeechSynthesizerDemo

## 読み上げ音声の比較

読み上げ音声の一覧

| macOSのバージョン | 声の種類 | rateの値 | 音声ファイルのサンプル |
|:---|:---|:---|:---|
| macOS 15.4 Sequoia | en-US Alex (Enhanced) | 0.5 | [alex50.wav]() |
| macOS 15.4 Sequoia | en-US Alex (Enhanced) | 1.0 | [alex100.wav]() |
| macOS 15.4 Sequoia | en-US Alex (Enhanced) | 2.0 | [alex200.wav]() |
| macOS 15.4 Sequoia | ja-JP Kyoko (Enhanced) | 1.0 | [sequoia_kyoko100.wav]() |
| macOS 12.7 Monterey | ja-JP Kyoko | 0.89 | [monterey_kyoko89.wav]() |

## （余談1）macOS 12 Montereyでの挙動

## （余談2）macOS 13 Ventura以降のAVSpeechSynthesizerインスタンス作成時の挙動

読み上げ速度とは直接関係しませんが、AVSpeechSynthesizerインスタンス作成時の挙動が異なります。

- macOS 12 Monterey以前: インスタンス作成直後にspeak()メソッドを実行しても即座に音声が読み上げされる。
- macOS 13 Ventura以降: インスタンス作成直後にspeak()メソッドを実行すると1秒ほど待たされた後に音声が読み上げされる。その後はspeak()メソッドを実行すると即座に音声が読み上げされる。

この挙動はmacOS 13 Venturaにて音声合成エンジンがSpeech ManagerからAudio unit v3 Extension方式に変更されたのが原因です。

なおSpeech ManagerはmacOS 13 Venturaで廃止されたため、読み上げ音声の初期待ち時間を回避する方法はありません。反応の機敏さを重視するアプリを開発するなら、アプリ起動時に何か適当な音声を再生してホットスタンバイな状態にさせるしかなさそうです。

## （余談3）sayコマンドの`-r, --rate`フラグについて

macOS 13 Venturaから音声合成エンジンの方式が変更されたことに伴い、AVSpeechSynthesizerと同様にsayコマンドの`-r, --rate`フラグによる読み上げ速度も若干変化しています。

ただし、sayコマンドの`--rate`フラグは1分間あたりに読み上げる単語数で読み上げの速度を指定する形になっています。AVSpeechUtteranceのrateプロパティとは異なり元から0.0 ... 1.0の範囲で正規化されていたわけではないので不都合はないかもしれません。

なお、macOS 13 Ventura以降のsayコマンドもAVSpeechSynthesizerと同様に初期化の待ち時間が発生します。`say Hello`のように、その場で読み上げた場合と、`say`のみ実行して標準入力の読み取り状態にした後に「Hello」を入力して音声を読み上げると待ち時間のさが確認できます。

## 参考資料

- [AVSpeechSynthesizer – Apple Developer Documentation](https://developer.apple.com/documentation/avfaudio/avspeechsynthesizer/)
- [AVSpeechSynthesisVoice – Apple Developer Documentation](https://developer.apple.com/documentation/avfaudio/avspeechsynthesisvoice)
- [AVSpeechUtterance – Apple Developer Documentation](https://developer.apple.com/documentation/avfaudio/avspeechutterance)

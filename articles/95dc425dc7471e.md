---
title: "[Swift] ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªãƒ‡ãƒã‚¤ã‚¹ã®ç‰©ç†çš„ãªãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚’å–å¾—ã™ã‚‹"
emoji: "ğŸ•"
type: "tech"
topics: [Swift AudioToolbox CoreAudio ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªMIDIè¨­å®š]
published: false
---
# ã¯ã˜ã‚ã«

ä»¥ä¸‹ã®ç’°å¢ƒã§å‹•ä½œç¢ºèªã—ã¾ã—ãŸã€‚

- macOS 12.1 Monterey
- Swift 5.5.1

# ç‰©ç†çš„ãªãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã¨ã¯

macOSã¯ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ã‹ã‚‰å—ã‘å–ã£ãŸä¿¡å·ã‚’32 bit Floatã«å¤‰æ›ã—ã¦å‡¦ç†ã‚’è¡Œã„ã¾ã™ã€‚å‡¦ç†ã—ãŸçµæœã¯å†ã³å¤‰æ›ã•ã‚Œã¦ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ã«æ¸¡ã•ã‚Œã¾ã™ã€‚ã“ã®ã¨ãä½¿ç”¨ã•ã‚Œã‚‹ãƒ“ãƒƒãƒˆæ·±åº¦ã¨æ•°å€¤å‹ã®çµ„ã¿åˆã‚ã›ã‚’ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã¨ã‚ˆã³ã¾ã™ã€‚

ã•ã¦ã€éŸ³å£°ã®å…¥å‡ºåŠ›ã‚’è¡Œã†ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ã«ã¯ãƒ‡ã‚¸ã‚¿ãƒ«ä¿¡å·ã¨ã‚¢ãƒŠãƒ­ã‚°ä¿¡å·ã‚’ç›¸äº’å¤‰æ›ã™ã‚‹å›è·¯ãŒæ­è¼‰ã•ã‚Œã¦ã„ã¾ã™ã€‚å…¥å‡ºåŠ›ã•ã‚Œã‚‹ä¿¡å·ã®ãƒ“ãƒƒãƒˆæ·±åº¦ã¨æ•°å€¤å‹ã®çµ„ã¿åˆã‚ã›ã¨ã—ã¦ã¯16 bit IntegerãŒä¸€èˆ¬çš„ã§ã™ã€‚ã“ã®ã‚ˆã†ãªãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ã®ä»•æ§˜ã‚‚ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã¨ã‚ˆã°ã‚Œã¾ã™ã€‚

ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã¨ã„ã†æ“è­·æ´¾æ›–æ˜§ãªãŸã‚ã€ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ã®ä»•æ§˜ã‚’æ„å‘³ã™ã‚‹å ´åˆã¯ç‰©ç†çš„ãªãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã¨ã‚ˆã³ã¾ã™ã€‚ã“ã®è¨˜äº‹ã§ã¯macOSãŒèªè­˜ã—ã¦ã„ã‚‹å…¥å‡ºåŠ›ãƒ‡ãƒã‚¤ã‚¹ã®ç‰©ç†çš„ãªãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚’å–å¾—ã™ã‚‹æ–¹æ³•ã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚

# å®Ÿè£…ä¾‹

ä¾‹ã¨ã—ã¦ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®å‡ºåŠ›ãƒ‡ãƒã‚¤ã‚¹ã®ç‰©ç†çš„ãªãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚’å–å¾—ã™ã‚‹ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’ç¤ºã—ã¾ã™ã€‚

ãªãŠã€`kAudioHardwarePropertyDefaultOutputDevice`ã¨`kAudioDevicePropertyScopeOutput`ã®`Output`ã®éƒ¨åˆ†ã‚’`Input`ã«æ›¸ãæ›ãˆã‚‹ã¨å…¥åŠ›ãƒ‡ãƒã‚¤ã‚¹ã®å–å¾—ãŒã§ãã¾ã™ã€‚

```swift
import AudioToolbox

func getAudioFormatFlag(_ value: AudioFormatFlags) -> String {
  var flags = [String]()

  if (value & kAudioFormatFlagIsFloat) == kAudioFormatFlagIsFloat {
    flags.append("Float")
  }
  if (value & kAudioFormatFlagIsBigEndian) == kAudioFormatFlagIsBigEndian {
    flags.append("Big")
  }
  if (value & kAudioFormatFlagIsSignedInteger) == kAudioFormatFlagIsSignedInteger {
    flags.append("Integer")
  }
  if (value & kAudioFormatFlagIsAlignedHigh) == kAudioFormatFlagIsAlignedHigh {
    flags.append("Align-High")
  }
  if (value & kAudioFormatFlagIsNonInterleaved) == kAudioFormatFlagIsNonInterleaved {
    flags.append("Non-Interleaved")
  }
  if (value & kAudioFormatFlagIsNonMixable) == kAudioFormatFlagIsNonMixable {
    flags.append("Non-Mixable")
  }
  if (value & kAudioFormatFlagsAreAllClear) == kAudioFormatFlagsAreAllClear {
    flags.append("All-Clear")
  }

  let v = flags.joined(separator: " ")

  return v == "" ? "Undefined" : v
}

func getAudioFormat(_ value: AudioFormatID) -> String {
  switch value {
  case kAudioFormatLinearPCM:
    return "PCM"
  case kAudioFormatAC3:
    return "AC3"
  case kAudioFormat60958AC3:
    return "AC3"
  case kAudioFormatAppleIMA4:
    return "IMA4"
  case kAudioFormatMPEG4AAC:
    return "AAC"
  case kAudioFormatMPEG4CELP:
    return "CELP"
  case kAudioFormatMPEG4HVXC:
    return "HVXC"
  case kAudioFormatMPEG4TwinVQ:
    return "TwinVQ"
  case kAudioFormatMACE3:
    return "MACE3"
  case kAudioFormatMACE6:
    return "MACE6"
  case kAudioFormatULaw:
    return "ULaw"
  case kAudioFormatALaw:
    return "ALaw"
  case kAudioFormatQDesign:
    return "QDesign"
  case kAudioFormatQDesign2:
    return "QDesign2"
  case kAudioFormatQUALCOMM:
    return "QUALCOMM"
  case kAudioFormatMPEGLayer1:
    return "MPEG1"
  case kAudioFormatMPEGLayer2:
    return "MPEG2"
  case kAudioFormatMPEGLayer3:
    return "MPEG3"
  case kAudioFormatTimeCode:
    return "TimeCode"
  case kAudioFormatMIDIStream:
    return "MIDIStream"
  case kAudioFormatParameterValueStream:
    return "ParameterValueStream"
  case kAudioFormatAppleLossless:
    return "AppleLossless"
  case kAudioFormatMPEG4AAC_HE:
    return "AAC-HE"
  case kAudioFormatMPEG4AAC_LD:
    return "AAC-LD"
  case kAudioFormatMPEG4AAC_ELD:
    return "AAC-ELD"
  case kAudioFormatMPEG4AAC_ELD_SBR:
    return "AAC-ELD-SBR"
  case kAudioFormatMPEG4AAC_HE_V2:
    return "AAC-HE-V2"
  case kAudioFormatMPEG4AAC_Spatial:
    return "AAC-Spatial"
  case kAudioFormatAMR:
    return "AMR"
  case kAudioFormatAudible:
    return "Audible"
  case kAudioFormatiLBC:
    return "iLBC"
  case kAudioFormatDVIIntelIMA:
    return "DVIIntelIMA"
  case kAudioFormatMicrosoftGSM:
    return "MicrosoftGSM"
  case kAudioFormatAES3:
    return "AES3"
  case kAudioFormatAMR_WB:
    return "AMR-WB"
  case kAudioFormatEnhancedAC3:
    return "EnhancedAC3"
  case kAudioFormatMPEG4AAC_ELD_V2:
    return "AAC-ELD-V2"
  case kAudioFormatFLAC:
    return "FLAC"
  case kAudioFormatMPEGD_USAC:
    return "USAC"
  case kAudioFormatOpus:
    return "Opus"
  default:
    return "Undefined"
  }
}

func main() {
  var address = AudioObjectPropertyAddress(
    mSelector: AudioObjectPropertySelector(kAudioHardwarePropertyDefaultOutputDevice),
    mScope: AudioObjectPropertyScope(kAudioObjectPropertyScopeGlobal),
    mElement: AudioObjectPropertyElement(kAudioObjectPropertyElementMain)
  )

  var size = UInt32(MemoryLayout<AudioDeviceID>.size)
  var deviceID = AudioDeviceID()

  AudioObjectGetPropertyData(
    AudioObjectID(kAudioObjectSystemObject), &address, 0, nil, &size, &deviceID)

  var deviceNameRef: CFString? = nil

  address.mSelector = kAudioObjectPropertyName
  size = UInt32(MemoryLayout<CFString?>.size)

  AudioObjectGetPropertyData(deviceID, &address, 0, nil, &size, &deviceNameRef)

  guard let deviceName = deviceNameRef else {
    fatalError("failed to obtain output device name")
  }

  var description = AudioStreamBasicDescription()

  address.mSelector = kAudioStreamPropertyPhysicalFormat
  address.mScope = kAudioDevicePropertyScopeOutput

  size = UInt32(MemoryLayout<AudioStreamBasicDescription>.size)

  AudioObjectGetPropertyData(deviceID, &address, 0, nil, &size, &description)

  let physicalFormat =
    "\(getAudioFormatFlag(description.mFormatFlags)) \(getAudioFormat(description.mFormatID))"

  print("Name: \(deviceName)")
  print("Channels: \(description.mChannelsPerFrame)")
  print("Bit Depth: \(description.mBitsPerChannel) bit \(physicalFormat)")
  print("Sample Rate: \(Int(description.mSampleRate)) Hz")
}

main()
```

# è©¦é‹è»¢

ä¸Šè¨˜ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’`main.swift`ã¨ã—ã¦ä¿å­˜ã—ã¦ãã ã•ã„ã€‚å®Ÿè¡Œã™ã‚‹ã¨ã€ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªMIDIè¨­å®šã«è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹å€¤ã¨åŒã˜ã‚‚ã®ãŒå‡ºåŠ›ã•ã‚Œã¾ã™ã€‚

```console
$ swift main.swift
Name: MacBook Pro Speakers
Channels: 2
Bit Depth: 32 bit Float PCM
Sample Rate: 96000 Hz
```

# å‚è€ƒè³‡æ–™

æ®‹å¿µãªãŒã‚‰ã€Swiftã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯å…¨ãæ•´å‚™ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚Apple Developerã®ã‚µã‚¤ãƒˆã«ã¯å®šæ•°ãŒåˆ—æŒ™ã•ã‚Œã¦ã„ã‚‹ã ã‘ã§ã™ã€‚ãã‚Œãã‚Œã®å®šæ•°ãŒä½•ã‚’æ„å‘³ã—ã¦ã„ã‚‹ã®ã‹ä¸€æ­³èª¬æ˜ãŒã‚ã‚Šã¾ã›ã‚“ã€‚ãã‚Œã©ã“ã‚ã‹ã€è¨˜äº‹ã‚’æŠ•ç¨¿ã—ãŸæ™‚ç‚¹ã§ã¯ãƒšãƒ¼ã‚¸ã®ã‚¿ã‚¤ãƒˆãƒ«ã™ã‚‰è¨­å®šã•ã‚Œã¦ã„ãªã„çŠ¶æ³ã§ã™ã€‚

- [Anonymous](https://developer.apple.com/documentation/coreaudio/core_audio_enumerations/1494464-anonymous)
- [Anonymous](https://developer.apple.com/documentation/coreaudio/core_audio_enumerations/1545886-anonymous)
- [Anonymous](https://developer.apple.com/documentation/coreaudio/core_audio_enumerations/1494449-anonymous)

ã©ã®ã‚ˆã†ãªå®šæ•°ãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹ã®ã‹ç¢ºèªã™ã‚‹ã«ã¯Obj-Cã®ãƒ˜ãƒƒãƒ€ãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç¢ºèªã™ã‚‹ã®ãŒæœ€ã‚‚ç¢ºå®Ÿã§ã™ã€‚é€šå¸¸ã¯ä»¥ä¸‹ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«æ ¼ç´ã•ã‚Œã¦ã„ã¾ã™ã€‚

- `/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk/System/Library/Frameworks/CoreAudio.framework/Versions/A/Headers`
- `/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk/System/Library/Frameworks/CoreAudioTypes.framework/Versions/A/Headers`

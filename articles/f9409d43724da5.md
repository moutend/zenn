---
title: "ï¼ˆå®Ÿè·µCloudflare Workersï¼‰Service bindingsã®ä½¿ã„æ–¹"
emoji: "ğŸ—‚"
type: "tech"
topics: [Cloudflare, "Cloudflare Workers", "Cloudflare Pages", JavaScript, TypeScript]
published: true
---
## ã¯ã˜ã‚ã«

Cloudflare Workersã«ã¯Bindingsï¼ˆãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ï¼‰ã¨ã‚ˆã°ã‚Œã‚‹ä»•çµ„ã¿ãŒã‚ã‚Šã¾ã™ã€‚ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ã‚’è¨­å®šã™ã‚‹ã¨ã€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®R2ã‚„ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®D1ãªã©ã€CloudflareãŒæä¾›ã™ã‚‹åˆ¥ã®ã‚µãƒ¼ãƒ“ã‚¹ã¨é€£æºã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

Service bindingsã¯ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ã®ä¸€ç¨®ã§ã‚ã‚Šã€WorkeråŒå£«ã§é€šä¿¡ã™ã‚‹ãŸã‚ã®ä»•çµ„ã¿ã§ã™ã€‚ç„¡æ–™ãƒ—ãƒ©ãƒ³ã¨æœ‰æ–™ãƒ—ãƒ©ãƒ³ã©ã¡ã‚‰ã§ã‚‚åˆ©ç”¨ã§ãã¾ã™ã€‚

é€šä¿¡ã¯ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã‚’çµŒç”±ã›ãšã€Cloudflareã®é–‰ã˜ã‚‰ã‚ŒãŸãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å†…ã§å®Œçµã—ã¾ã™ã€‚ãã®ãŸã‚é€šå¸¸ã®`fetch()`é–¢æ•°ã®å‘¼ã³å‡ºã—ã¨æ¯”è¼ƒã—ã¦ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ãƒ¼ã¯ç„¡è¦–ã§ãã‚‹ã»ã©å°ã•ããªã‚Šã¾ã™ã€‚ã¾ãŸã€ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã‚’çµŒç”±ã—ãªã„ãŸã‚éå…¬é–‹ã®WorkeråŒå£«ã§é€šä¿¡å¯èƒ½ã§ã™ã€‚

Service bindingsãŒãƒªãƒªãƒ¼ã‚¹ã•ã‚ŒãŸã®ã¯2022å¹´5æœˆ10æ—¥ã§ã™ã€‚å®‰å®šã—ã¦ã„ã‚‹ã¨ã¯æ€ã„ã¾ã™ãŒã€å°†æ¥çš„ã«ä»•æ§˜ãŒå¤‰æ›´ã•ã‚Œã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè£…ã™ã‚‹éš›ã¯æœ€æ–°ã®å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

- ï¼ˆå‚è€ƒï¼‰[Service Bindings are generally available, with efficient pricing - The Cloudflare Blog](https://blog.cloudflare.com/service-bindings-ga/)

## å®Ÿè¡Œç’°å¢ƒ

è¨˜äº‹ã®æŠ•ç¨¿ã«ã‚ãŸã‚Šã€ä»¥ä¸‹ã®ç’°å¢ƒã«ã¦å‹•ä½œç¢ºèªã‚’è¡Œã„ã¾ã—ãŸã€‚

- wranglerã‚³ãƒãƒ³ãƒ‰ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³: v3.4.0
- wrangler.tomlãƒ•ã‚¡ã‚¤ãƒ«ã®compatibility_date`: `2023-07-24

## Service bindingsã‚’è©¦ã™

ãã‚Œã§ã¯ã€2ã¤ã®Workerã‚’ä½œæˆã—ã€Service bindingsã‚’è¨­å®šã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚èª¬æ˜ã®éƒ½åˆã§TypeScriptã‚’é¸ã³ã¾ã—ãŸãŒã€JavaScriptã§ã‚‚Service bindingsã¯åˆ©ç”¨å¯èƒ½ã§ã™ã€‚

### Worker Bï¼ˆ`name = "banana"`ï¼‰ã®ä½œæˆ

ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚

```console
$ cd /tmp
$ npm create cloudflare@latest
```

`/tmp`ã¯é©å½“ãªãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§æ§‹ã„ã¾ã›ã‚“ã€‚ã‚³ãƒãƒ³ãƒ‰ã®å®Ÿè¡Œå¾Œã«è¡¨ç¤ºã•ã‚Œã‚‹è³ªå•ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ç­”ãˆã¦ãã ã•ã„ã€‚

- In which directory do you want to create your application?
  - ã€Œbananaã€ã¨å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚
- What type of application do you want to create?
  - ã€ŒHello World" Workerã€ã‚’é¸ã‚“ã§ãã ã•ã„ã€‚
- Do you want to use TypeScript?
  - ã€Œyã€ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚
- Do you want to deploy your application?
  - ã€Œnã€ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚

ã‚³ãƒãƒ³ãƒ‰ã®å®Ÿè¡ŒãŒå®Œäº†ã—ãŸã‚‰ã€`/tmp/banana`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç§»å‹•ã—ã¦ãã ã•ã„ã€‚ãã®å¾Œã€`wrangler.toml`ã¨`src/worker.ts`ã‚’ä»¥ä¸‹ã®å†…å®¹ã§ç½®ãæ›ãˆã¦ãã ã•ã„ã€‚

#### wrangler.toml

```toml
name = "banana"
main = "src/worker.ts"
compatibility_date = "2023-07-24"
usage_model = "bundled"
workers_dev = false
```

#### src/worker.ts

```ts
interface BananaResponse {
	timestamp: number;
	random: string;
}

export default {
	async fetch(request: Request, env: Env, ctx: ExecutionContext): Promise<Response> {
		const response: BananaResponse = {
			timestamp: new Date().getTime(),
			random: crypto.randomUUID(),
		};

		return Response.json(response);
	},
};
```

### Worker Aï¼ˆ`name = "apple"`ï¼‰ã®ä½œæˆ

ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚

```console
$ cd /tmp
$ npm create cloudflare@latest
```

`/tmp`ã¯é©å½“ãªãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§æ§‹ã„ã¾ã›ã‚“ã€‚ã‚³ãƒãƒ³ãƒ‰ã®å®Ÿè¡Œå¾Œã«è¡¨ç¤ºã•ã‚Œã‚‹è³ªå•ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ç­”ãˆã¦ãã ã•ã„ã€‚

- In which directory do you want to create your application?
  - ã€Œappleã€ã¨å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚
- What type of application do you want to create?
  - ã€ŒHello World" Workerã€ã‚’é¸ã‚“ã§ãã ã•ã„ã€‚
- Do you want to use TypeScript?
  - ã€Œyã€ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚
- Do you want to deploy your application?
  - ã€Œnã€ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚

ã‚³ãƒãƒ³ãƒ‰ã®å®Ÿè¡ŒãŒå®Œäº†ã—ãŸã‚‰ã€`/tmp/apple`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç§»å‹•ã—ã¦ãã ã•ã„ã€‚ãã®å¾Œã€`wrangler.toml`ã¨`src/worker.ts`ã‚’ä»¥ä¸‹ã®å†…å®¹ã§ç½®ãæ›ãˆã¦ãã ã•ã„ã€‚

#### wrangler.toml

```toml
name = "apple"
main = "src/worker.ts"
compatibility_date = "2023-07-24"
usage_model = "bundled"

services = [
  { binding = "banana", service = "banana" }
]
```

#### src/worker.ts

```ts
export interface Env {
	banana: Fetcher;
}

interface BananaResponse {
	timestamp: number;
	random: string;
}

export default {
	async fetch(request: Request, env: Env, ctx: ExecutionContext): Promise<Response> {
		const response1 = await env.banana.fetch(request.clone());
		const response2 = await env.banana.fetch(request.clone());
		const response3 = await env.banana.fetch(request.clone());

		const body1: BananaResponse = await response1.json();
		const body2: BananaResponse = await response2.json();
		const body3: BananaResponse = await response3.json();

		return Response.json({
			appleTimestamp: new Date().getTime(),
			appleRandom: crypto.randomUUID(),
			bananaTimestamps: [body1.timestamp, body2.timestamp, body3.timestamp],
			bananaRandoms: [body1.random, body2.random, body3.random],
		});
	},
};
```

### ãƒ‡ãƒ—ãƒ­ã‚¤

Workerã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¾ã—ã‚‡ã†ã€‚ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚

```console
$ cd /tmp/banana
$ npx wrangler deploy

$ cd /tmp/apple
$ npx wrangler deploy
```

### å‹•ä½œç¢ºèª

ãƒ‡ãƒ—ãƒ­ã‚¤ãŒå®Œäº†ã—ãŸã‚‰å‹•ä½œç¢ºèªã‚’ã—ã¾ã—ã‚‡ã†ã€‚`curl`ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ã¿ã¦ãã ã•ã„ã€‚

```console
$ curl https://apple.ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå.workers.dev
```

ä»¥ä¸‹ã®ã‚ˆã†ãªãƒ¬ã‚¹ãƒãƒ³ã‚¹ãŒè¿”ã•ã‚Œã¾ã™ã€‚

```json
{
  "appleTimestamp": 1690769131344,
  "appleRandom": "203e5036-c243-4dfd-9925-5248f3985d9e",
  "bananaTimestamps": [
    1690769131344,
    1690769131344,
    1690769131344
  ],
  "bananaRandoms": [
    "3f393baa-5f61-4099-b2ea-9fd1a4af2db4",
    "53a58b26-4bfe-499f-a217-47718b3afe75",
    "f92536e4-31af-4133-b29d-23c62ed00ad3"
  ]
}
```

ä½™è«‡ã«ãªã‚Šã¾ã™ãŒã€ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã®æ•°å€¤ã«æ³¨ç›®ã—ã¦ãã ã•ã„ã€‚ã™ã¹ã¦åŒã˜å€¤ã§ã™ã€‚ã“ã‚Œã¯é–‰ã˜ã‚‰ã‚ŒãŸãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®ä¸­ã§é«˜é€Ÿã«é€šä¿¡ã—ã¦ã„ã‚‹ã‹ã‚‰åŒã˜å€¤ã«ãªã£ãŸã®ã§ã¯ãªãã€Spectreå¯¾ç­–ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®éƒ½åˆã§æ„å›³çš„ã«åŒã˜å€¤ãŒè¿”ã•ã‚Œã¦ã„ã¾ã™ã€‚å¾“ã£ã¦ã€ä¾‹ãˆã°`new Date().getTime()`ã®å·®åˆ†ã§ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ãƒ¼ã®æ¸¬å®šã¯ã§ãã¾ã›ã‚“ã€‚

- ï¼ˆå‚è€ƒï¼‰[Security model - Cloudflare Workers docs](https://developers.cloudflare.com/workers/learning/security-model/)

## è§£èª¬

ã“ã“ã‹ã‚‰ã¯`wrangler.toml`ã®è¨­å®šã¨`src/worker.ts`ã®å®Ÿè£…ã«ã¤ã„ã¦è§£èª¬ã—ã¾ã™ã€‚

### wrangler.tomlã®è§£èª¬

ã¾ãšã€appleã¨bananaå…±é€šã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«ã¤ã„ã¦ã§ã™ã€‚å†’é ­ã®3è¡Œã¯Workerã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹éš›ã«æ¯å›æŒ‡å®šã™ã‚‹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§ã™ã€‚ç‰¹åˆ¥ãªã“ã¨ã¯ã—ã¦ã„ãªã„ãŸã‚ã€èª¬æ˜ã¯ã‚¹ã‚­ãƒƒãƒ—ã—ã¾ã™ã€‚

```toml
name = "Workerã®åå‰"
main = "src/worker.ts"
compatibility_date = "2023-07-24"
```

`usage_model`ã«ã¤ã„ã¦ã¯`bundled`ã‚’æŒ‡å®šã—ã¦ã„ã¾ã™ã€‚CPUã®åˆ©ç”¨æ™‚é–“ãŒ50 msã«åˆ¶é™ã•ã‚Œã¦ã„ã‚‹ç’°å¢ƒã§ã‚‚å•é¡Œãªãå‹•ä½œã™ã‚‹ã“ã¨ã‚’ç¤ºã™ãŸã‚ã«è¨­å®šã—ãŸã ã‘ã§ã™ã€‚Service bindingsã®æŒ¯ã‚‹èˆã„ã«ã¯å½±éŸ¿ã—ã¾ã›ã‚“ã€‚

```toml
usage_model = "bundled"
```

#### banana/wrangler.toml

`workers_dev`ã«`false`ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã§Workerã‚’éå…¬é–‹ã«è¨­å®šã—ã¦ã„ã¾ã™ã€‚

```toml
workers_dev = false
```

#### apple/wrangler.toml

Service bindingsã¯ä»¥ä¸‹ã®è¡Œã§è¨­å®šã•ã‚Œã¦ã„ã¾ã™ã€‚

```toml
services = [
  { binding = "banana", service = "banana" }
]
```

`service`ã«ã¯Workerã®åå‰ã‚’æŒ‡å®šã—ã¾ã™ã€‚å…·ä½“çš„ã«ã¯ã€æ¥ç¶šå…ˆWorkerã‚’æ§‹æˆã—ã¦ã„ã‚‹`wrangler.toml`ã®`name`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®å€¤ã‚’æŒ‡å®šã—ã¾ã™ã€‚ä»Šå›ã§ã‚ã‚Œã°`banana`ãŒè©²å½“ã—ã¾ã™ã€‚

`binding`ã«æŒ‡å®šã—ãŸåå‰ã¯`src/worker.ts`ã®fetchãƒãƒ³ãƒ‰ãƒ©ã®envå¼•æ•°ã«ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¨ã—ã¦ç´ä»˜ã‘ã•ã‚Œã¾ã™ã€‚ä¾‹ãˆã°bindingã®å€¤ãŒ`Worker1`ã§ã‚ã‚Œã°ã€JavaScript / TypeScriptã‚³ãƒ¼ãƒ‰ã‹ã‚‰ã¯`env.Worker1`ã¨ã—ã¦å‚ç…§ã§ãã¾ã™ã€‚

`binding`ã«æŒ‡å®šã™ã‚‹å€¤ã«ã¯å‘½åè¦å‰‡ãŒã‚ã‚Šã¾ã›ã‚“ã€‚Workerã®åå‰ã¨åŒã˜åå‰ã‚’è¨­å®šã—ã¦ã‚‚æ§‹ã„ã¾ã›ã‚“ã—ã€åˆ¥ã®åå‰ã§ã‚‚æ§‹ã„ã¾ã›ã‚“ã€‚ã¾ãŸã€å¤§æ–‡å­—ã¨å°æ–‡å­—ã®æŒ‡å®šã‚‚ã‚ã‚Šã¾ã›ã‚“ã€‚`worker1`ãƒ»`Worker1`ãƒ»`WORKER1`ãªã©è‡ªç”±ã«è¨­å®šã§ãã¾ã™ã€‚

ã‚ˆãã‚ã‚‹é–“é•ã„ã¨ã—ã¦ã¯`service`ã¨`binding`ã®å€¤ã‚’é€†ã«æŒ‡å®šã™ã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚ä¾‹ãˆã°`binding`ã¨ã—ã¦`banana`ã€`service`ã¨ã—ã¦`Worker1`ã‚’æŒ‡å®šã™ã‚‹ã¨ã€`env.Worker1.fetch()`ã¯undefinedã«å¯¾ã™ã‚‹é–¢æ•°å‘¼ã³å‡ºã—ã«ãªã‚‹ãŸã‚å¤±æ•—ã—ã¾ã™ã€‚

ãã®ã‚ˆã†ãªé–“é•ã„ã‚’é¿ã‘ã‚‹ãŸã‚ã«`binding`ã¨`service`ã«ã¯åŒã˜åå‰ã‚’æŒ‡å®šã™ã‚‹ã€ã¨ã„ã†ãƒ«ãƒ¼ãƒ«ã‚’æ±ºã‚ã‚‹ã®ã‚‚ä¸€ã¤ã®æ‰‹æ®µã§ã™ã€‚ãŸã ã—ã€ãã†ã™ã‚‹ã¨Workerã®åå‰ã¯JavaScriptã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£åã¨ã—ã¦æœ‰åŠ¹ãªåå‰ã‚’æŒ‡å®šã™ã‚‹åˆ¶ç´„ãŒç”Ÿã˜ã¾ã™ã€‚

Service bindingsã¯è¤‡æ•°æŒ‡å®šã§ãã¾ã™ã€‚ãŸã ã—ã€ä¸€åº¦ã«å‘¼ã³å‡ºã›ã‚‹Workerã«ã¯åˆ¶é™ãŒã‚ã‚Šã¾ã™ã€‚è©³ã—ãã¯å¾Œè¿°ã—ã¾ã™ã€‚

### src/worker.tsã®è§£èª¬

`banana/src/worker.ts`ã«ã¤ã„ã¦ã¯Service bindingsã«é–¢é€£ã™ã‚‹å‡¦ç†ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ä»¥é™ã¯`apple/src/worker.ts`ã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚

ã¾ãšã€å†’é ­ã®`export interface Env`ã¯Service bindingsãŒåˆ©ç”¨ã§ãã‚‹ã‚ˆã†ã«è¨­å®šã—ã¦ã„ã‚‹ç®‡æ‰€ã§ã™ã€‚ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£åã¯`wrangler.toml`ã§æŒ‡å®šã—ãŸ`binding`ã®åå‰ã€å‹ã¯`Fetcher`ã‚’æŒ‡å®šã—ã¾ã™ã€‚

```ts
export interface Env {
	banana: Fetcher;
}
```

æ¬¡ã¯`fetch()`ã®å‘¼ã³å‡ºã—ã‚’ã—ã¦ã„ã‚‹ç®‡æ‰€ã«ã¤ã„ã¦ã§ã™ã€‚é€šå¸¸ã®`fetch()`ã§ã¯ãªã`env.ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£å.fetch()`ã‚’åˆ©ç”¨ã—ã¦ã„ã‚‹ç‚¹ã«æ³¨ç›®ã—ã¦ãã ã•ã„ã€‚

```ts
const response1 = await env.banana.fetch(request.clone());
const response2 = await env.banana.fetch(request.clone());
const response3 = await env.banana.fetch(request.clone());
```

`env.ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°å.fetch()`ã¨JavaScriptæ¨™æº–APIã®`fetch()`ã®ã‚·ã‚°ãƒãƒãƒ£ã¯åŒã˜ã§ã™ã€‚å¾“ã£ã¦ã€Fetcherã®å¼•æ•°ã«ã¯`Request`å‹ã®å€¤ã‚’æ¸¡ã™ã‹ã€URLæ–‡å­—åˆ—ã¨ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’æ¸¡ã—ã¾ã™ã€‚

ã‚‚ã¡ã‚ã‚“ã€åŒã˜Workerã«å¯¾ã—ã¦è¤‡æ•°å›ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã—ã¦ã‚‚æ§‹ã„ã¾ã›ã‚“ã€‚ãŸã ã—ã€Service bindingsã«ã¯ã„ãã¤ã‹åˆ¶ç´„ãŒã‚ã‚Šã¾ã™ã€‚è©³ç´°ã«ã¤ã„ã¦ã¯å¾Œè¿°ã—ã¾ã™ã€‚

ã‚‚ã†ã²ã¨ã¤æ³¨ç›®ã—ã¦ã„ãŸã ããŸã„ã®ãŒ`request.clone()`ã§ã™ã€‚åŒã˜ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ä½¿ã„å›ã™ã¨æ„å›³ã—ãªã„ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å€¤ãŒæ›¸ãå¤‰ã‚ã‚‹æã‚ŒãŒã‚ã‚‹ãŸã‚ã€`clone()`ã§ãƒ‡ã‚£ãƒ¼ãƒ—ã‚³ãƒ”ãƒ¼ã‚’ä½œæˆã—ã¦ã„ã¾ã™ã€‚å˜ç™ºã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹å ´åˆãªã©ã€å€¤ãŒæ›¸ãå¤‰ã‚ã‚‹å¿ƒé…ãŒãªã„çŠ¶æ³ã§ã¯`request.clone()`ã§ã¯ãªã`request`ã‚’ç›´æ¥æ¸¡ã™å½¢ã§ã‚‚å•é¡Œã‚ã‚Šã¾ã›ã‚“ã€‚

## ã‚ˆãã‚ã‚‹è³ªå•

Service bindingsã‚’åˆ©ç”¨ã™ã‚‹ä¸Šã§é­é‡ã™ã‚‹ç–‘å•ã«ç­”ãˆã¾ã™ã€‚

### ï¼ˆQ. 1ï¼‰ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯æ–°ã—ãä½œæˆã™ã‚‹ã¨ã©ã†ãªã‚‹ï¼Ÿ

æ­£å¸¸ã«å‡¦ç†ã•ã‚Œã¾ã™ã€‚ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯ãã®å ´ã§æ–°ã—ãä½œæˆã—ã¦ã‚‚æ§‹ã„ã¾ã›ã‚“ã€‚ä»¥ä¸‹ã«å®Ÿè£…ä¾‹ã‚’ç¤ºã—ã¾ã™ã€‚

```ts
const response = await env.Worker1.fetch(request.url, {
	cf: request.cf,
	method: 'POST',
	headers: new Headers({
		...request.headers,
		'Content-Type': 'application/json',
		'Foo': 'bar',
	}),
	body: JSON.stringify({
		value: 123,
	}),
});
```

ãã®å ´ã§æ–°ã—ããƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ä½œæˆã™ã‚‹éš›ã¯URLã¨ã—ã¦`request.url`ã‚’åˆ©ç”¨ã—ã¦ãã ã•ã„ã€‚ãªãŠã€`request.url`ã®ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«ã¤ã„ã¦ã¯é™¤å»ã—ãŸã‚Šè¿½åŠ ã—ã¦ã‚‚æ§‹ã„ã¾ã›ã‚“ã€‚

Fetcherã«æ¸¡ã™URLã¨ã—ã¦`https://example.com`ã®ã‚ˆã†ãªåˆ¥ã‚ªãƒªã‚¸ãƒ³ã‚’æŒ‡å®šã™ã‚‹ã¨ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯å¤±æ•—ã—ã¾ã™ã€‚Fetcherã¯Cloudflareå†…ã®é–‰ã˜ãŸãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ã‚‹ãŸã‚ã®å°‚ç”¨ãƒ¡ã‚½ãƒƒãƒ‰ã§ã™ã€‚å¤–éƒ¨ãƒªã‚½ãƒ¼ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ãŸã„å ´åˆã¯é€šå¸¸ã®`fetch()`ã‚’åˆ©ç”¨ã—ã¦ãã ã•ã„ã€‚

ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã«ã¤ã„ã¦ã¯`cf`ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¨`headers`ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’å¼•ãç¶™ãã‚ˆã†ã«å®Ÿè£…ã™ã‚‹ã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™ã€‚`cf`ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¯CloudflareãŒç‹¬è‡ªã«è¿½åŠ ã—ãŸãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã§ã™ã€‚ã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«æ‰±ã„ã«ãªã£ã¦ã„ã¾ã™ãŒã€æŒ™å‹•ãŒå¤‰ã‚ã‚‹å¯èƒ½æ€§ã«å‚™ãˆã‚‹ãŸã‚çœç•¥ã—ãªã„ã»ã†ãŒç„¡é›£ã‹ã¨æ€ã„ã¾ã™ã€‚

`headers`ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«ã¤ã„ã¦ã‚‚åŒæ§˜ã§ã™ã€‚ã‚ã‚‹æ—¥çªç„¶Cloudflareã®ç‹¬è‡ªãƒ˜ãƒƒãƒ€ãƒ¼ãŒè¿½åŠ ã•ã‚Œãªã„ã¨ã‚‚é™ã‚‰ãªã„ã®ã§ã€å…ƒã®ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰æ¼”ç®—å­ã§å±•é–‹ã—ãŸä¸Šã§ä¸Šæ›¸ãã™ã‚‹ã‚ˆã†ãªå½¢ã§å®Ÿè£…ã™ã‚‹ã®ãŒãƒ™ã‚¿ãƒ¼ã‹ã¨æ€ã„ã¾ã™ã€‚

ãªãŠã€ã‚ªãƒªã‚¸ãƒŠãƒ«ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®`cf`ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¨`headers`ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«ã¤ã„ã¦ã¯ã€æ–°ã—ãä½œæˆã™ã‚‹ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«å«ã‚ãªãã¦ã‚‚æœ‰åŠ¹ãªãƒªã‚¯ã‚¨ã‚¹ãƒˆã¨ã—ã¦é€ä¿¡ã•ã‚Œã¾ã™ã€‚

### ï¼ˆQ. 2ï¼‰å…¬é–‹ã•ã‚Œã¦ã„ã‚‹WorkeråŒå£«ã§é€šå¸¸ã®`fetch()`ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã©ã†ãªã‚‹ï¼Ÿ

ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã™ã€‚å…·ä½“çš„ã«ã¯Error Code 1042ã§ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒæ‹’å¦ã•ã‚Œã¾ã™ã€‚

ä¾‹ãˆã°ã€`https://aaa.account1.workers.dev`ã¨`https://bbb.account1.workers.dev`åŒå£«ã§é€šå¸¸ã®`fetch()`é–¢æ•°ã‚’åˆ©ç”¨ã—ã¦é€šä¿¡ã™ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚

ç•°ãªã‚‹ã‚µãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³é–“ã§ã‚‚Error Code 1042ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã™ã€‚ä¾‹ãˆã°`https://aaa.account1.workers.dev`ã¨`https://aaa.account2.workers.dev`åŒå£«ã§é€šå¸¸ã®`fetch()`é–¢æ•°ã‚’åˆ©ç”¨ã—ã¦é€šä¿¡ã™ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚

ã“ã‚Œã¯`*.workers.dev`ãƒ‰ãƒ¡ã‚¤ãƒ³ã«é©ç”¨ã•ã‚Œã‚‹ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®åˆ¶é™ã§ã™ã€‚å›é¿ã™ã‚‹ã«ã¯ç‹¬è‡ªã®ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’è³¼å…¥ã—ã¦ã€Workerã«è¨­å®šã—ã¦ãã ã•ã„ã€‚

ã¾ãŸã€åŒã˜`*.ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå.workers.dev`ã‚µãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³ã«å±ã™ã‚‹WorkeråŒå£«ã§ã‚ã‚Œã°ã€ã‚ãˆã¦ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã‚’çµŒç”±ã™ã‚‹å¿…è¦ã¯ãªã„ãŸã‚ã€Service bindingsã‚’åˆ©ç”¨ã—ã¦é€šä¿¡ã™ã‚‹ã“ã¨ã§ã‚¨ãƒ©ãƒ¼ã¯å›é¿ã§ãã¾ã™ã€‚

## åˆ¶é™

ä¾¿åˆ©ãªService bindingsã§ã™ãŒã€ã„ãã¤ã‹åˆ¶é™ãŒè¨­ã‘ã‚‰ã‚Œã¦ã„ã¾ã™ã€‚ä»¥ä¸‹ã€Cloudflareå…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‹ã‚‰å¼•ç”¨ã—ã¾ã™ã€‚

> 1. Each request to a Worker via Service bindings count toward your subrequest limit.
> 2. Nested calls to child Workers increase the depth of your Worker Pipeline. Maximum Pipeline depth is 32, including the first Worker. Subsequent calls will throw an exception.
> 3. Simultaneous open connection limits are Pipeline-wide, meaning subrequests from multiple different Workers incur a global concurrent subrequest limit. However, a `fetch` call on a Service binding does not count as an open connection.
> 
> 1. ã‚µãƒ¼ãƒ“ã‚¹ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ã‚’ä»‹ã—ãŸãƒ¯ãƒ¼ã‚«ãƒ¼ã¸ã®å„ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯ã€ã‚µãƒ–ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®åˆ¶é™ã«ã‚«ã‚¦ãƒ³ãƒˆã•ã‚Œã¾ã™ã€‚
> 2. å­Workerã¸ã®ãƒã‚¹ãƒˆã—ãŸå‘¼ã³å‡ºã—ã¯Workerãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®æ·±ã•ã‚’å¢—åŠ ã•ã›ã¾ã™ã€‚æœ€å¤§ã®ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³æ·±ã•ã¯32ã§ã‚ã‚Šã€æœ€åˆã®ãƒ¯ãƒ¼ã‚«ãƒ¼ã‚‚å«ã¾ã‚Œã¾ã™ã€‚ãã‚Œä»¥é™ã®å‘¼ã³å‡ºã—ã¯ä¾‹å¤–ã‚’ã‚¹ãƒ­ãƒ¼ã—ã¾ã™ã€‚
> 3. åŒæ™‚ã«ã‚ªãƒ¼ãƒ—ãƒ³ã•ã‚Œã‚‹æ¥ç¶šã®åˆ¶é™ã¯ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å…¨ä½“ã«é©ç”¨ã•ã‚Œã¾ã™ã€‚ã¤ã¾ã‚Šã€è¤‡æ•°ã®ç•°ãªã‚‹ãƒ¯ãƒ¼ã‚«ãƒ¼ã‹ã‚‰ã®ã‚µãƒ–ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯ã€ã‚°ãƒ­ãƒ¼ãƒãƒ«ãªåŒæ™‚ã‚µãƒ–ãƒªã‚¯ã‚¨ã‚¹ãƒˆåˆ¶é™ãŒç™ºç”Ÿã—ã¾ã™ã€‚ãŸã ã—ã€ã‚µãƒ¼ãƒ“ã‚¹ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ä¸Šã®`fetch`å‘¼ã³å‡ºã—ã¯ã‚ªãƒ¼ãƒ—ãƒ³ãªæ¥ç¶šã¨ã—ã¦ã‚«ã‚¦ãƒ³ãƒˆã•ã‚Œã¾ã›ã‚“ã€‚
> 
> ï¼ˆå¼•ç”¨å…ƒï¼‰[Limits - Cloudflare Workers docs](https://developers.cloudflare.com/workers/platform/limits/)

ãã‚Œãã‚Œè©³ã—ãèª¬æ˜ã—ã¾ã™ã€‚

### ã‚µãƒ–ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®åˆ¶é™

Cloudflareå…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®æ–‡è„ˆã§ã€Œã‚µãƒ–ãƒªã‚¯ã‚¨ã‚¹ãƒˆã€ã¨ã¯ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆä¸Šã®ãƒªã‚½ãƒ¼ã‚¹ã«å¯¾ã™ã‚‹`fetch()`é–¢æ•°ã®å‘¼ã³å‡ºã—ã®ã“ã¨ã§ã™ã€‚Service bindingsã‚’åˆ©ç”¨ã—ãŸWorkerã«å¯¾ã™ã‚‹ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã‚’çµŒç”±ã—ã¾ã›ã‚“ãŒã‚µãƒ–ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¨ã—ã¦ã‚«ã‚¦ãƒ³ãƒˆã•ã‚Œã¾ã™ã€‚

ã‚µãƒ–ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å›æ•°ã«ã¯ä»¥ä¸‹ã®åˆ¶é™ãŒè¨­ã‘ã‚‰ã‚Œã¦ã„ã¾ã™ã€‚å›æ•°ã¯æœ€åˆã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å—ã‘å–ã£ãŸWorkerã‚’èµ·ç‚¹ã«ã‚«ã‚¦ãƒ³ãƒˆã—ã¾ã™ã€‚

- ç„¡æ–™ãƒ—ãƒ©ãƒ³: 1ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚ãŸã‚Š50å›
- æœ‰æ–™ãƒ—ãƒ©ãƒ³ï¼ˆBundledï¼‰: 1ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚ãŸã‚Š50å›
- æœ‰æ–™ãƒ—ãƒ©ãƒ³ï¼ˆUnboundï¼‰: 1ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚ãŸã‚Š1000å›

ãªãŠã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒCloudflareã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã«é–‰ã˜ã‚‰ã‚Œã¦ã„ã‚‹å ´åˆã€ã¤ã¾ã‚ŠService bindingsã‚’åˆ©ç”¨ã—ãŸã‚µãƒ–ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å›æ•°åˆ¶é™ã¯ãƒ—ãƒ©ãƒ³ã«ã‚ˆã‚‰ãš1ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚ãŸã‚Š1000å›ã«ãªã‚‹ãã†ã§ã™ã€‚

### ãƒã‚¹ãƒˆã•ã‚ŒãŸå‘¼ã³å‡ºã—ã®åˆ¶é™

ãƒã‚¹ãƒˆã•ã‚ŒãŸå‘¼ã³å‡ºã—ã¨ã„ã†ã®ã¯ã€Worker AãŒWorker Bã‚’å©ãã€worker BãŒWorker Cã‚’å©ãã€Worker CãŒWorker Dã‚’å©ãã€...ã¨ã„ã†çŠ¶æ³ã®ã“ã¨ã§ã™ã€‚

ä»®ã«ãã‚Œãã‚Œã®WorkerãŒ100å›ã‚µãƒ–ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹ã¨ã—ã¦ãƒã‚¹ãƒˆã®æ·±ã•ãŒ3æ®µã§ã‚ã‚Œã°ã€`100^3 = 1000000`ã§ã™ã‹ã‚‰ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®æ•°ã¯ã‚¨ã‚¯ã‚¹ãƒãƒãƒ³ã‚·ãƒ£ãƒ«ã«å¢—åŠ ã—ã¾ã™ã€‚ã“ã‚Œã‚’é˜²ããŸã‚ã€æœ€åˆã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å—ã‘å–ã£ãŸWorkerã‚’èµ·ç‚¹ã¨ã—ã¦ã€ã‚µãƒ–ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å›æ•°ã¯50ã‚ã‚‹ã„ã¯1000ã«åˆ¶é™ã•ã‚Œã¦ã„ã‚‹ã‚ã‘ã§ã™ã€‚

è¨˜äº‹ã®åŸ·ç­†æ™‚ç‚¹ã§ã¯ãƒã‚¹ãƒˆã®æ·±ã•ãŒ32æ®µã«åˆ¶é™ã•ã‚Œã¦ã„ã¾ã™ã€‚å°†æ¥çš„ã«åˆ¶é™ãŒç·©å’Œã•ã‚Œã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒã€ãƒã‚¹ãƒˆãŒæ·±ã™ãã‚‹ã¨ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®è¨­è¨ˆã¨ã—ã¦è¦‹é€šã—ãŒè‰¯ã„ã¨ã¯è¨€ãˆã¾ã›ã‚“ã€‚

ãã‚‚ãã‚‚ãƒã‚¹ãƒˆãŒæ·±ã™ãã‚‹çŠ¶æ³ã¯æ„å›³ã—ãªã„Workerã®å‘¼ã³å‡ºã—ãŒè¡Œã‚ã‚Œã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚32æ®µã®åˆ¶é™ã¯Workerã®æš´èµ°ã‚’æ­¢ã‚ã‚‹ãŸã‚ã®å®‰å…¨è£…ç½®ã§ã‚ã‚‹ã¨è§£é‡ˆã™ã‚‹ã¹ãã§ã™ã€‚

### åŒæ™‚æ¥ç¶šæ•°ã®åˆ¶é™

å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ã‚ˆã‚‹ã¨ã€è¨˜äº‹ã®åŸ·ç­†æ™‚ç‚¹ã§ã¯åŒæ™‚ã«é–‹ã‘ã‚‹ã‚³ãƒã‚¯ã‚·ãƒ§ãƒ³ã®æ•°ã¯6ã¤ã«åˆ¶é™ã•ã‚Œã¦ã„ã‚‹ãã†ã§ã™ã€‚ã“ã‚Œã«ã¯ã‚µãƒ–ãƒªã‚¯ã‚¨ã‚¹ãƒˆã ã‘ã§ãªãã€ä¾‹ãˆã°ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®R2ã‚’èª­ã¿æ›¸ãã™ã‚‹éš›ã®ã‚³ãƒã‚¯ã‚·ãƒ§ãƒ³ã‚‚å«ã¾ã‚Œã¾ã™ã€‚

åŠ ãˆã¦ã€ã“ã®åˆ¶é™ã¯Service bindingsã§å‘¼ã³å‡ºã—ãŸWorkerå…¨ä½“ã«å…±æœ‰ã®åˆ¶é™ã¨ã—ã¦é©ç”¨ã•ã‚Œã¾ã™ã€‚

ä¾‹ãˆã°ã€Worker AãŒR2ã®èª­ã¿å–ã‚Šã¨Worker Bã®å‘¼ã³å‡ºã—ã‚’è¡Œã„ã€Worker BãŒR2ã®èª­ã¿å–ã‚Šã¨å¤–éƒ¨ãƒªã‚½ãƒ¼ã‚¹ã®`fetch()`å‘¼ã³å‡ºã—ã‚’ã™ã‚‹ã¨ã€åŒæ™‚ã«é–‹ã‹ã‚Œã¦ã„ã‚‹ã‚³ãƒã‚¯ã‚·ãƒ§ãƒ³ã¯3æœ¬ã¨ã—ã¦ã‚«ã‚¦ãƒ³ãƒˆã•ã‚Œã¾ã™ã€‚Service bindingsã‚’åˆ©ç”¨ã—ãŸWorkerã®å‘¼ã³å‡ºã—ã¯ã‚«ã‚¦ãƒ³ãƒˆã‹ã‚‰é™¤å¤–ã•ã‚Œã‚‹ãŸã‚ã€4æœ¬ã§ã¯ãªã3æœ¬ã«ãªã‚Šã¾ã™ã€‚

ãªãŠã€åŒæ™‚ã«é–‹ã‘ã‚‹ã‚³ãƒã‚¯ã‚·ãƒ§ãƒ³ã®ä¸Šé™ã«é”ã™ã‚‹ã¨ã€ã‚³ãƒã‚¯ã‚·ãƒ§ãƒ³ã¯ã‚­ãƒ¥ãƒ¼ã«ç©ã¾ã‚Œã¦å¾…ã¡çŠ¶æ…‹ã«ãªã‚Šã¾ã™ã€‚ã‚‚ã—ã‚³ãƒã‚¯ã‚·ãƒ§ãƒ³ãŒé–‹ãã£ã±ãªã—ã§èª­ã¿æ›¸ããŒè¡Œã‚ã‚Œãªã„ã¨ã€ãƒ‡ãƒƒãƒ‰ãƒ­ãƒƒã‚¯ã¨è¦‹ãªã•ã‚Œã¦ã‚³ãƒã‚¯ã‚·ãƒ§ãƒ³ã¯least-recently-usedæ–¹å¼ã§ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã•ã‚Œã¾ã™ã€‚

## æ–™é‡‘

Service bindingsã¯ç„¡æ–™ãƒ—ãƒ©ãƒ³ã¨æœ‰æ–™ãƒ—ãƒ©ãƒ³ã©ã¡ã‚‰ã§ã‚‚åˆ©ç”¨ã§ãã¾ã™ã€‚ãŸã ã—ã€æœ‰æ–™ãƒ—ãƒ©ãƒ³ã®å ´åˆã€Bundledã¨Unboundã§ã‚³ã‚¹ãƒˆã«å·®ãŒç”Ÿã˜ã¾ã™ã€‚ä»¥ä¸‹ã€å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‹ã‚‰å¼•ç”¨ã—ã¾ã™ã€‚

> Service bindings cost the same as any normal Worker. Each invocation is charged as if it is a request from the Internet with one important difference. You will be charged a single billable duration across all Workers triggered by a single incoming request.
> 
> Service bindingsã®è²»ç”¨ã¯é€šå¸¸ã®Workerã¨åŒã˜ã§ã™ã€‚å„å‘¼ã³å‡ºã—ã¯ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã‹ã‚‰ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã§ã‚ã‚‹ã‹ã®ã‚ˆã†ã«èª²é‡‘ã•ã‚Œã¾ã™ãŒã€1ã¤é‡è¦ãªé•ã„ãŒã‚ã‚Šã¾ã™ã€‚å˜ä¸€ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«ã‚ˆã£ã¦ãƒˆãƒªã‚¬ãƒ¼ã•ã‚Œã‚‹ã™ã¹ã¦ã®Workerã«å¯¾ã—ã¦ã€å˜ä¸€ã®è«‹æ±‚æœŸé–“ã¨ã—ã¦èª²é‡‘ã•ã‚Œã¾ã™ã€‚

Bundledã¯ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å›æ•°ã‚’ã‚‚ã¨ã«èª²é‡‘ã•ã‚Œã‚‹ãƒ—ãƒ©ãƒ³ã§ã™ã€‚ä¾‹ãˆã°Worker AãŒWorker Bã‚’å‘¼ã³å‡ºã—ã€Worker BãŒWorker Cã‚’å‘¼ã³å‡ºã™å®Ÿè£…ã§ã‚ã‚Œã°ã€åˆè¨ˆ3ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¨ã—ã¦èª²é‡‘ã•ã‚Œã¾ã™ã€‚

Bundledãƒ—ãƒ©ãƒ³ã¯1ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚ãŸã‚Šã®CPUåˆ©ç”¨æ™‚é–“ãŒ50 msä»¥ä¸‹ã«åˆ¶é™ã•ã‚Œã¦ã„ã¾ã™ã€‚åˆ¥ã®è¦‹æ–¹ã‚’ã™ã‚Œã°ã€CPUåˆ©ç”¨æ™‚é–“ãŒ1 msã§ã‚‚50 msã§ã‚‚è«‹æ±‚ã•ã‚Œã‚‹è²»ç”¨ã¯åŒã˜ã§ã™ã€‚

Unboundã¯Workerã®åˆ©ç”¨æ™‚é–“ã‚’ã‚‚ã¨ã«èª²é‡‘ã•ã‚Œã‚‹ãƒ—ãƒ©ãƒ³ã§ã™ã€‚Workeré–“ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ•°ã«é–¢ä¿‚ãªãã€åˆ©ç”¨æ™‚é–“ã‚’å…ƒã«èª²é‡‘ã•ã‚Œã¾ã™ã€‚

ä¾‹ãˆã°Worker AãŒ1 msã€Worker BãŒ2 msã®CPUåˆ©ç”¨æ™‚é–“ã‚’æ¶ˆè²»ã™ã‚‹ã¨ã—ã¦ã€AãŒBã‚’å‘¼ã³å‡ºã™ã¨åˆ©ç”¨æ™‚é–“ã¯3 msæ¶ˆè²»ã—ãŸã‚‚ã®ã¨ã‚«ã‚¦ãƒ³ãƒˆã•ã‚Œã¾ã™ã€‚AãŒ3 msã€BãŒ2 msã€åˆè¨ˆ5 msã¨ã—ã¦é‡è¤‡èª²é‡‘ã•ã‚Œã‚‹ã“ã¨ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚

å¾“ã£ã¦ã€å¤šãã®å ´åˆã¯Unboundãƒ—ãƒ©ãƒ³ã§Workerã‚’é‹ç”¨ã™ã‚‹ã»ã†ãŒã‚³ã‚¹ãƒˆã‚’æŠ‘ãˆã‚‰ã‚Œã¾ã™ã€‚ã‚³ã‚¹ãƒˆã®è¦‹ç©ã‚Šã«ã¤ã„ã¦ã¯ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ç‰¹æ€§ã‚’è€ƒæ…®ã—ã¦å„è‡ªã§è¨ˆç®—ã—ã¦ãã ã•ã„ã€‚

## Cloudflare Pages Functionsã§ã®Service bindingsã®åˆ©ç”¨ã«ã¤ã„ã¦

Pages Functionsã®å®Ÿæ…‹ã¯Workersã§ã™ã€‚å¾“ã£ã¦ã€Pages Functionsã«ã‚‚Service bindingsã‚’è¨­å®šã§ãã¾ã™ã€‚ãŸã ã—ã€Workersã¨ã¯ç•°ãªã‚‹ç‚¹ãŒã‚ã‚Šã¾ã™ã€‚

1. ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ã®è¨­å®šã¯wrangler.tomlã§ã¯ãªãCloudflareã®ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ç”»é¢ã‹ã‚‰è¡Œã„ã¾ã™ã€‚
2. Pages Functionsã‹ã‚‰åˆ¥ã®Pages Functionsã‚’å‘¼ã³å‡ºã™ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚Workersã‹ã‚‰Pages Functionsã‚’å‘¼ã³å‡ºã™ã“ã¨ã‚‚ã§ãã¾ã›ã‚“ã€‚Pages Functionsã‹ã‚‰Workersã‚’å‘¼ã³å‡ºã™ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ã¿å¯èƒ½ã§ã™ã€‚

ä¸Šè¨˜ã®ç›¸é•ç‚¹ã‚’é™¤ãã€Pages Functionsã¨Workersã®Service bindingsã¯åŒã˜ã§ã™ã€‚ä¾‹ãˆã°éå…¬é–‹ã®Workerã‚’ã‚¤ãƒ³ã‚¿ãƒãƒƒãƒˆã«å…¬é–‹ã•ã‚Œã¦ã„ã‚‹Pages Functionsã‹ã‚‰å‘¼ã³å‡ºã™ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚

## æ—¢çŸ¥ã®å•é¡Œ

Service bindingsã«ã¯ä»¥ä¸‹ã®å•é¡ŒãŒã‚ã‚Šã¾ã™ã€‚Cloudflareã®ã‚¤ãƒ³ãƒ•ãƒ©ã¯æ—¥ã€…æ”¹å–„ã•ã‚Œã¦ã„ã‚‹ãŸã‚è¿‘ã„å°†æ¥ã«è§£æ¶ˆã•ã‚Œã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒã€ç¾æ™‚ç‚¹ã§é­é‡ã™ã‚‹å•é¡Œã‚’ã¾ã¨ã‚ã¾ã™ã€‚

### Pages Functionsãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç’°å¢ƒã§ã®ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã«æœªå¯¾å¿œ

`wrangler pages dev`ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã¨ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç’°å¢ƒã§Functionsã‚’è©¦ã™ã“ã¨ãŒã§ãã¾ã™ã€‚ãŸã ã—ã€Service bindingsã‚’ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã§ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆã™ã‚‹æ©Ÿèƒ½ãŒæä¾›ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚

å…¬å¼ã©ã‚­ãƒ¥ã‚¨ãƒ³ãƒˆã«ã¯`wrangler pages dev`ã‚³ãƒãƒ³ãƒ‰ã«`--service`ãƒ•ãƒ©ã‚°ã‚’æ¸¡ã›ã°OKã¨æ›¸ã‹ã‚Œã¦ã„ãŸæ™‚æœŸãŒã‚ã£ãŸãã†ã§ã™ãŒã€ä»Šã¯å‰Šé™¤ã•ã‚Œã¦ã—ã¾ã£ãŸã‚ˆã†ã§ã™ã€‚å‰Šé™¤ã«è¨€ã„ãŸã£ãŸçµŒç·¯ã¯ä¸æ˜ã§ã™ãŒã€ãã®ã†ã¡å†å®Ÿè£…ã•ã‚Œã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚æ°—é•·ã«å¾…ã¡ã¾ã—ã‚‡ã†ã€‚

- ï¼ˆå‚è€ƒï¼‰[Issue #343 - ğŸ› BUG/ wrangler pages dev doesn't support service bindings or the `--service` argument](https://github.com/cloudflare/workers-sdk/issues/3436)

### ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã®è¡¨ç¤º

Service bindingsã‚’è¨­å®šã™ã‚‹ã¨Cloudflareã®ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«ã¯ã€ŒConnected Worker: 1ã€ã®ã‚ˆã†ã«æ¥ç¶šæƒ…å ±ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

ãŸã ã—ã€å‘¼ã³å‡ºã™å´ã®Workerã«ã—ã‹æ¥ç¶šæƒ…å ±ãŒè¡¨ç¤ºã•ã‚Œã¾ã›ã‚“ã€‚å‘¼ã³å‡ºã•ã‚Œã‚‹å´ã®Workerã«ã¤ã„ã¦ã¯ã€ã€ã©ã®Workerã‹ã‚‰å‘¼ã³å‡ºã•ã‚Œã¦ã„ã‚‹ã®ã‹è¡¨ç¤ºã•ã‚Œã¾ã›ã‚“ã€‚Pages Functionsã«Service bindingsã‚’è¨­å®šã—ãŸå ´åˆã‚‚åŒæ§˜ã§ã™ã€‚

å¤§ã—ãŸå•é¡Œã§ã¯ãªã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒã€å€‹äººçš„ã«ã¯å‘¼ã³å‡ºã—å´ã¨å‘¼ã³å‡ºã•ã‚Œã‚‹å´ã®ä¸¡æ–¹ã«æ¥ç¶šæƒ…å ±ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã¨å¬‰ã—ã„ã§ã™ã€‚çš†ã•ã‚“ã¯ã€ŒConnected Worker: 0ã€ã®è¡¨ç¤ºã‚’è¦‹ã¦ã‚‚ç„¦ã‚‰ãªã„ã‚ˆã†ã”æ³¨æ„ãã ã•ã„ã€‚

### wrangler deployå®Ÿè¡Œæ™‚ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸

ç¾çŠ¶ã§ã¯`wrangler.toml`ã«Service bindingsã‚’è¨­å®šã™ã‚‹ã¨ã€ã€Œ"services" fields are experimental and may change or break at any time.ã€ã¨è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚ã™ã§ã«ãƒ™ãƒ¼ã‚¿ç‰ˆã®æœŸé–“ã¯çµ‚äº†ã—ã¦èª°ã§ã‚‚åˆ©ç”¨ã§ãã‚‹ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®ã¯ãšã§ã™ãŒã€ãªãœã‹è­¦å‘ŠãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

## ãŠã‚ã‚Šã«

ã„ãã¤ã‹åˆ¶é™ã¯ã‚ã‚Šã¾ã™ãŒã€Service bindingsã‚’é§†ä½¿ã™ã‚Œã°Cloudflare Workersã‚’ã•ã‚‰ã«æ´»ç”¨ã§ãã‚‹ã“ã¨ãŒç†è§£ã„ãŸã ã‘ãŸã‹ã¨æ€ã„ã¾ã™ã€‚

## å‚è€ƒè³‡æ–™

1. [Bindings - Cloudflare Workers docs](https://developers.cloudflare.com/workers/platform/bindings/)
2. [About Service bindings - Cloudflare Workers docs](https://developers.cloudflare.com/workers/platform/bindings/about-service-bindings/)
3. [Limits - Cloudflare Workers docs](https://developers.cloudflare.com/workers/platform/limits/)
4. [Service bindings - Runtime APIs - Cloudflare Workers docs](https://developers.cloudflare.com/workers/runtime-apis/service-bindings/)
5. [FetchEvent - Runtime APIs - Cloudflare Workers docs](https://developers.cloudflare.com/workers/runtime-apis/fetch-event/)
6. [Request - Runtime APIs - Cloudflare Workers docs](https://developers.cloudflare.com/workers/runtime-apis/request/)
7. [Response - Runtime APIs - Cloudflare Workers docs](https://developers.cloudflare.com/workers/runtime-apis/response/)
8. [Config - Wrangler - Cloudflare Workers docs](https://developers.cloudflare.com/workers/wrangler/configuration/)
9. [Service bindings - Cloudflare Pages docs](https://developers.cloudflare.com/pages/platform/functions/bindings/#service-bindings)

---
title: "ï¼ˆSwiftï¼‰wavå½¢å¼ã®éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’Int16ã®é…åˆ—ã¨ã—ã¦èª­ã¿è¾¼ã‚€"
emoji: "ðŸ•Œ"
type: "tech"
topics: [Swift, éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«, éŸ³å£°ä¿¡å·å‡¦ç†]
published: true
---
## ã¯ã˜ã‚ã«

ä»¥ä¸‹ã®ç’°å¢ƒã§å‹•ä½œæ¤œè¨¼ã—ã¾ã—ãŸã€‚

```console
$ swift --version
Apple Swift version 5.3.2 (swiftlang-1200.0.45 clang-1200.0.32.28)
Target: x86_64-apple-darwin19.6.0
```

## WAVå½¢å¼ã®éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’Int16ã®é…åˆ—ã¨ã—ã¦èª­ã¿è¾¼ã‚€

```swift
import AVFoundation

func readWavFile(_ path: String) -> [[Int16]]? {
    guard let url = URL(string: path) else {
        return nil
    }
    guard let audio = try? AVAudioFile(forReading: url, commonFormat: .pcmFormatInt16, interleaved: false) else {
        return nil
    }
    guard let buffer = AVAudioPCMBuffer(pcmFormat: audio.processingFormat, frameCapacity: AVAudioFrameCount(audio.length)) else {
        return nil
    }
    do {
        try audio.read(into: buffer)
    } catch {
        return nil
    }
    guard let int16ChannelData = buffer.int16ChannelData else {
        return nil
    }

    var channelData = [[Int16]]()

    for i in 0 ..< Int(audio.processingFormat.channelCount) {
        channelData.append(Array(UnsafeBufferPointer(start: int16ChannelData[i], count: Int(buffer.frameLength))))
    }

    return channelData
}
```

`readWavFile()`ã®ä½¿ç”¨ä¾‹

```swift
func printSignal(_ path: String) {
    guard let signal = readWavFile(path) else {
        return
    }
    if signal.count < 2 {
        return
    }

    print("Left\tRight")

    for i in 0 ..< signal[0].count {
        print(String(format: "%d\t%d", signal[0][i], signal[1][i]))
    }
}

printSignal("/tmp/music.wav")
```

ã‚³ãƒ¼ãƒ‰ã¯[gist](https://gist.github.com/moutend/4bebd485967f4c11cc4fe8e6a2185121)ã«ã‚‚å…¬é–‹ã—ã¦ã‚ã‚Šã¾ã™ã€‚

## ï¼ˆä½™è«‡ãã®1ï¼‰AVAudioFileã®ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã«ã¤ã„ã¦

AVAudioFileã®ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã¯2ç¨®é¡žã‚ã‚Šã¾ã™ã€‚

1. `init(forReading: URL, commonFormat: AVAudioCommonFormat, interleaved: Bool)`
2. `init(forReading: URL)`

WAVå½¢å¼ã®éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã«ã¯16 bit integerã‚„32 bit floatãªã©ã®ç¬¦å·åŒ–æ–¹å¼ãŒã‚ã‚Šã¾ã™ã€‚1ç•ªç›®ã®ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã®commonFormatã¯ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚€ã¨ãã«ä½¿ç”¨ã™ã‚‹ç¬¦å·åŒ–æ–¹å¼ã‚’æŒ‡å®šã™ã‚‹ãŸã‚ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§ã™ã€‚

ã•ã¦ã€2ç•ªç›®ã®ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã«ã¯ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿ã®ç¬¦å·åŒ–æ–¹å¼ã‚’æŒ‡å®šã™ã‚‹ãŸã‚ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚è‡ªå‹•çš„ã«åˆ¤åˆ¥ã—ã¦ãã‚Œã‚‹ã®ã§ã—ã‚‡ã†ã‹ï¼Ÿæ®‹å¿µãªãŒã‚‰ã€ãã®ã‚ˆã†ãªæ°—ã®åˆ©ã„ãŸã“ã¨ã¯ã—ã¦ãã‚Œã¾ã›ã‚“ã€‚

2ç•ªç›®ã®commonFormatã‚’æŒ‡å®šã—ãªã„ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã®å ´åˆã€ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿ã®ç¬¦å·åŒ–æ–¹å¼ã¯å¸¸ã«32 bit floatã«ãªã‚Šã¾ã™ã€‚ã“ã®æŒ™å‹•ã¯Appleã®APIãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ã«æ›¸ã‹ã‚Œã¦ã„ãªã„ãŸã‚ã€ä¸å…·åˆãªã®ã‹ä»•æ§˜ãªã®ã‹åˆ¤æ–­ã§ãã¾ã›ã‚“ã€‚ç¢ºå®Ÿã«å‡¦ç†ã—ãŸã„ã®ã§ã‚ã‚Œã°ã€1ç•ªç›®ã®ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã‚’ä½¿ã£ã¦ãã ã•ã„ã€‚

ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ãŒå¤±æ•—ã™ã‚‹ã¨ãã¯`AVAudioFile.fileFormat`ã¨`AVAudioFile.processingFormat`ã‚’æ¯”è¼ƒã—ã¦ãã ã•ã„ã€‚fileFormatã«ã¯ãƒ•ã‚¡ã‚¤ãƒ«æœ¬æ¥ã®ç¬¦å·åŒ–æ–¹å¼ã€processingFormatã«ã¯èª­ã¿è¾¼ã¿ã«ä½¿ç”¨ã™ã‚‹ç¬¦å·åŒ–æ–¹å¼ãŒæ ¼ç´ã•ã‚Œã¦ã„ã¾ã™ã€‚

## ï¼ˆä½™è«‡ãã®2ï¼‰interleaved

AVAudioFileã®ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã«ã¯ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¨ã—ã¦interleavedãŒã‚ã‚Šã¾ã™ã€‚ä»Šã¾ã§çŸ¥ã‚‰ãªã‹ã£ãŸã®ã§ã™ãŒã€WAVå½¢å¼ã®éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã«ã¯ã‚¤ãƒ³ã‚¿ãƒ¼ãƒªãƒ¼ãƒ–ã¨ã‚ˆã°ã‚Œã‚‹æ©Ÿèƒ½ãŒã‚ã‚‹ãã†ã§ã™ã€‚

é€šå¸¸ã€ã‚¹ãƒ†ãƒ¬ã‚ªéŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã«ã¯L, R, L, R, ...ã®ã‚ˆã†ã«å·¦ãƒãƒ£ãƒãƒ«ã¨å³ãƒãƒ£ãƒãƒ«ã®ã‚µãƒ³ãƒ—ãƒ«ãŒäº¤äº’ã«è¨˜éŒ²ã•ã‚Œã¦ã„ã¾ã™ã€‚ãã‚Œã«å¯¾ã—ã¦ã‚¤ãƒ³ã‚¿ãƒ¼ãƒªãƒ¼ãƒ–ãŒæœ‰åŠ¹ã«ãªã£ã¦ã„ã‚‹ã¨ãƒ¢ãƒŽãƒ©ãƒ«ã®éŸ³å£°ãŒ2ã¤åŽéŒ²ã•ã‚Œã¦ã„ã‚‹ã¨è§£é‡ˆã•ã‚Œã¾ã™ã€‚

## ï¼ˆä½™è«‡ãã®3ï¼‰é‡å­åŒ–ãƒ“ãƒƒãƒˆæ•°ãŒä¸€è‡´ã—ãªã„å ´åˆã®æŒ™å‹•

ä¾‹ãˆã°AVAudioFileã®commonFormatã¨ã—ã¦16 bit integerã‚’æŒ‡å®šã—ã€24 bit integerã¾ãŸã¯32 bit integerã§ç¬¦å·åŒ–ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚€ã¨ä¸‹ä½ã®ãƒ“ãƒƒãƒˆã¯åˆ‡ã‚Šæ¨ã¦ã‚‰ã‚Œã¦16 bit integerã¨ã—ã¦èª­ã¿è¾¼ã¾ã‚Œã¾ã™ã€‚é€†ã«ãƒ“ãƒƒãƒˆæ•°ãŒè¶³ã‚Šãªã„å ´åˆã¯0ã§åŸ‹ã‚ã‚‰ã‚Œã¾ã™ã€‚

## ãŠã‚ã‚Šã«

ã‚ˆã‚ŠçŸ­ã„ã‚³ãƒ¼ãƒ‰ã§éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚ã‚‹æ–¹æ³•ãŒã‚ã‚Œã°ã€ãœã²æ•™ãˆã¦ãã ã•ã„ã€‚

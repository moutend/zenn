---
title: "ï¼ˆiOSï¼‰AVAudioPlayerNodeã§éŸ³å£°ãŒå†ç”Ÿã•ã‚Œãªã„å ´åˆã®å¯¾å‡¦æ³•"
emoji: "ğŸ•Œ"
type: "tech"
topics: [iOS, Swift, AVFoundation, AVAudioPlayerNode, AVAudioEngine]
published: true
---
## ã¯ã˜ã‚ã«

ä»¥ä¸‹ã®ç’°å¢ƒã§å‹•ä½œæ¤œè¨¼ã—ã¾ã—ãŸã€‚

- Xcode 12.5 (12E262)
- iOS 14.5.1

## çµè«–

AVAudioPlayerNodeã®å‡ºåŠ›å…ˆãŒè¨­å®šã•ã‚Œã¦ã„ãªã„çŠ¶æ…‹ã§`scheduleFile`ã‚’å‘¼ã³å‡ºã™ã¨ã‚¢ãƒ—ãƒªãŒã‚¯ãƒ©ãƒƒã‚·ãƒ¥ã—ã¾ã™ã€‚ä»¥é™ã¯Playãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨éŸ³å£°ãŒå†ç”Ÿã•ã‚Œã‚‹ã‚¢ãƒ—ãƒªã‚’ä¾‹ã«èª¬æ˜ã—ã¾ã™ã€‚

## é–“é•ã£ãŸå®Ÿè£…

```swift
import AVFoundation
import SwiftUI

struct ContentView: View {
    let engine = AVAudioEngine()
    let playerNode = AVAudioPlayerNode()

    var body: some View {
        Button("Play") {
            self.playerNode.play()
        }
    }
    init() {
        guard let url = Bundle.main.url(forResource: "Music", withExtension: "wav") else {
            fatalError("failed to build file path")
        }
        guard let music = try? AVAudioFile(forReading: url) else {
            fatalError("failed to read file")
        }

        self.playerNode.scheduleFile(music, at: nil, completionHandler: nil)

        let outputFormat = engine.outputNode.inputFormat(forBus: 0)

        self.engine.attach(self.playerNode)
        self.engine.connect(self.playerNode, to: self.engine.mainMixerNode, format: outputFormat)

        do {
            try self.engine.start()
        } catch {
            fatalError("failed to start audio engine")
        }
    }
}

struct ContentView_Previews: PreviewProvider {
    static var previews: some View {
        ContentView()
    }
}
```

ä¸Šè¨˜ã®å®Ÿè£…ã§ã¯AVAudioEngineã®`connect()`ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‘¼ã³å‡ºã™å‰ã«`scheduleFile()`ã‚’å‘¼ã³å‡ºã—ã¦ã„ã¾ã™ã€‚å®Ÿè¡Œã™ã‚‹ã¨ãƒ‡ãƒãƒƒã‚°ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«ã€Œrequired condition is false ...ã€ã¨ã„ã†ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã¦ã‚¢ãƒ—ãƒªãŒã‚¯ãƒ©ãƒƒã‚·ãƒ¥ã—ã¾ã™ã€‚

ã‚¢ãƒ—ãƒªã®ã‚¯ãƒ©ãƒƒã‚·ãƒ¥ã¨åŒæ™‚ã«LLDBã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãŒèµ·å‹•ã™ã‚‹ã®ã§ã€`bt`ã¨å…¥åŠ›ã—ã¦ãƒãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹ã‚’è¡¨ç¤ºã—ã¦ã¿ã¦ãã ã•ã„ã€‚`scheduleFile()`ãŒã‚¯ãƒ©ãƒƒã‚·ãƒ¥ã®åŸå› ã§ã‚ã‚‹ã¨ç¢ºèªã§ãã¾ã™ã€‚

## æ­£ã—ã„å®Ÿè£…

```swift
import AVFoundation
import SwiftUI

struct ContentView: View {
    let engine = AVAudioEngine()
    let playerNode = AVAudioPlayerNode()

    var body: some View {
        Button("Play") {
            self.playerNode.play()
        }
    }
    init() {
        guard let url = Bundle.main.url(forResource: "Music", withExtension: "wav") else {
            fatalError("failed to build file path")
        }
        guard let music = try? AVAudioFile(forReading: url) else {
            fatalError("failed to read file")
        }

        let outputFormat = engine.outputNode.inputFormat(forBus: 0)

        self.engine.attach(self.playerNode)
        self.engine.connect(self.playerNode, to: self.engine.mainMixerNode, format: outputFormat)

        self.playerNode.scheduleFile(music, at: nil, completionHandler: nil)

        do {
            try self.engine.start()
        } catch {
            fatalError("failed to start audio engine")
        }
    }
}

struct ContentView_Previews: PreviewProvider {
    static var previews: some View {
        ContentView()
    }
}
```

ä¸Šè¨˜ãŒæ­£ã—ã„å®Ÿè£…ã§ã™ã€‚ã“ã®å®Ÿè£…ã§ã‚ã‚Œã°ã‚¢ãƒ—ãƒªã¯ã‚¯ãƒ©ãƒƒã‚·ãƒ¥ã—ã¾ã›ã‚“ã€‚ãŸã‹ãŒ1è¡Œã§ã™ãŒã€å‘¼ã³å‡ºã™ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã«ã¯æ³¨æ„ã—ã¦ãã ã•ã„ã€‚

## ãƒã‚°ãªã®ã‹ä»•æ§˜ãªã®ã‹

æ–­å®šå£èª¿ã§è¨˜äº‹ã‚’æ›¸ãã¾ã—ãŸãŒã€ã“ã®æŒ™å‹•ã¯ãƒã‚°ãªã®ã‹ä»•æ§˜ãªã®ã‹ã‚ã‹ã‚Šã¾ã›ã‚“ã€‚Apple Developerã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ã¯å‘¼ã³å‡ºã—ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã«ã¤ã„ã¦ä¸€æ­³è¨˜è¿°ãŒã‚ã‚Šã¾ã›ã‚“ã€‚ãªã«ã‹ã”å­˜çŸ¥ã®æ–¹ã¯ã‚³ãƒ¡ãƒ³ãƒˆã„ãŸã ã‘ã‚‹ã¨åŠ©ã‹ã‚Šã¾ã™ã€‚

## å‚è€ƒè³‡æ–™

- [AVAudioPlayerNode | Apple Developer](https://developer.apple.com/documentation/avfaudio/avaudioplayernode)

---
title: "ï¼ˆSwiftï¼‰Visionãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã‚’ç”¨ã„ã¦ç”»åƒã‹ã‚‰æ—¥æœ¬èªã®ãƒ†ã‚­ã‚¹ãƒˆã‚’æŠ½å‡ºã™ã‚‹"
emoji: "ğŸ“‘"
type: "tech"
topics: [Apple, iOS, Swift, OCR]
published: false
---
## ã¯ã˜ã‚ã«

æ—¥æœ¬èªOCRã®è©±é¡Œã§ã™ã€‚iOS 16ä»¥é™ã€Visionãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ãŒæä¾›ã™ã‚‹ãƒ†ã‚­ã‚¹ãƒˆæŠ½å‡ºæ©Ÿèƒ½ã®è¨€èªã¨ã—ã¦æ—¥æœ¬èªãŒåˆ©ç”¨å¯èƒ½ã«ãªã‚Šã¾ã—ãŸã€‚ã“ã®è¨˜äº‹ã§ã¯å®Ÿè£…ä¾‹ã‚’ç¤ºã—ãŸå¾Œã«ã€æ—¥æœ¬èªãƒ†ã‚­ã‚¹ãƒˆæŠ½å‡ºã®æ³¨æ„ç‚¹ã‚’ã¾ã¨ã‚ã¾ã™ã€‚

## ç’°å¢ƒ

ä»¥ä¸‹ã®ç’°å¢ƒã«ã¦å‹•ä½œç¢ºèªã‚’è¡Œã„ã¾ã—ãŸã€‚

- iOS 17.5.1
- Xcode Version 15.4 (15F31d)

## è£œè¶³

å®Ÿè£…ä¾‹ã«é€²ã‚€å‰ã«2ç‚¹è£œè¶³ã—ã¾ã™ã€‚

### æ—¥æœ¬èªãŒåˆ©ç”¨å¯èƒ½ã‹åˆ¤å®šã™ã‚‹

æ–°è¦ã«ã‚¢ãƒ—ãƒªã‚’åˆ¶ä½œã™ã‚‹å ´åˆã¯ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚’iOS 16ä»¥é™ã«è¨­å®šã™ã‚Œã°ç¢ºå®Ÿã«æ—¥æœ¬èªãŒåˆ©ç”¨ã§ãã¾ã™ã€‚ã‚ã‚‹ã„ã¯ãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ–ã‚’æŒ‡å®šã—ã¦iOSãƒãƒ¼ã‚¸ãƒ§ãƒ³ã”ã¨ã«å®Ÿè£…ã‚’åˆ†å²ã•ã›ã‚‹æ–¹æ³•ã‚‚è€ƒãˆã‚‰ã‚Œã¾ã™ã€‚

ä¸€æ–¹ã€ã‚¢ãƒ—ãƒªå®Ÿè¡Œæ™‚ã«æ—¥æœ¬èªãŒåˆ©ç”¨å¯èƒ½ã‹åˆ¤å®šã—ãŸã„å ´åˆã‚‚ã‚ã‚Šã¾ã™ã€‚VNRecognizeTextRequestã®supportedRecognitionLanguagesãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ã™ã‚Œã°ä»¥ä¸‹ã®ã‚ˆã†ã«åˆ¤å®šã§ãã¾ã™ã€‚

```swift
do {
  let request = VNRecognizeTextRequest()
  let languages = try request.supportedRecognitionLanguages()
  // languagesã«ã¯ISOè¨€èªã‚³ãƒ¼ãƒ‰ã®æ–‡å­—åˆ—ãŒæ ¼ç´ã•ã‚Œã‚‹ã€‚æ—¥æœ¬èªãŒåˆ©ç”¨å¯èƒ½ãªå ´åˆã¯ja-JPãŒå«ã¾ã‚Œã‚‹ã€‚
} catch {
  fatalError("Failed to get supported languages: \(error)")
}
```

### iOS 18ä»¥é™ã®Visionãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã«ã¤ã„ã¦

Apple Developerãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ã‚ˆã‚‹ã¨ã€iOS 18ä»¥é™ã®Visionãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ãŒæ¬¡ã®ã‚ˆã†ã«å¤‰æ›´ã•ã‚Œã‚‹ãã†ã§ã™ã€‚

> Starting in iOS 18.0, the Vision framework provides a new Swift-only API. See Original Objective-C and Swift API to view the original API.
> 
> å¼•ç”¨å…ƒ https://developer.apple.com/documentation/vision

æ—¢å­˜ã®APIã«å½±éŸ¿ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ã“ã®è¨˜äº‹ã§ã¯Original Objective-C and Swift APIã¨ã—ã¦æä¾›ã•ã‚Œã¦ã„ã‚‹APIã‚’å‰æã«èª¬æ˜ã‚’é€²ã‚ã¾ã™ã€‚

## å®Ÿè£…ä¾‹

Apple Developerãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«å®Ÿè£…ã®è©³ã—ã„èª¬æ˜ãŒã‚ã‚Šã¾ã™ã€‚ã¾ãšã¯ãã¡ã‚‰ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

[Recognizing Text in Images - Apple Developer Documentation](https://developer.apple.com/documentation/vision/recognizing-text-in-images)

å‚è€ƒã¾ã§ã«å®Ÿè£…ä¾‹ã‚’ç¤ºã—ã¾ã™ã€‚

```swift
import CoreImage
import Vision

class TextRecognizer {
  func perform(ciImage: CIImage) {
    let handler = VNImageRequestHandler(ciImage: ciImage)
    let request = VNRecognizeTextRequest(completionHandler: self.recognizeTextHandler)

    request.recognitionLanguages = ["ja-JP", "en-US"]

    do {
      try handler.perform([request])
    } catch {
      print("Unable to perform the requests: \(error).")
    }
  }
  func recognizeTextHandler(request: VNRequest, error: Error?) {
    guard let observations = request.results as? [VNRecognizedTextObservation] else {
      return
    }
    for observation in observations {
      guard let candidate = observation.topCandidates(1).first else {
        continue
      }

      let stringRange = candidate.string.startIndex..<candidate.string.endIndex

      guard let box = try? candidate.boundingBox(for: stringRange) else {
        continue
      }

      let width = box.bottomRight.x - box.topLeft.x
      let height = box.topLeft.y - box.bottomRight.y

      let info = String(
        format: "Confidence(%.1f)\tBox(x: %.2f, y: %.2f, width: %.2f, height: %.2f)",
        candidate.confidence, box.topLeft.x, box.topLeft.y, width, height
      )

      print("\(info)\t\(candidate.string)")
    }
  }
}
```

## å®Ÿè£…ã®è€ƒæ…®äº‹é …

### Fastã¨Accurate

ãƒ†ã‚­ã‚¹ãƒˆã®èªè­˜ã¯Fastï¼ˆé«˜é€Ÿï¼‰ã¨Accurateï¼ˆé«˜ç²¾åº¦ï¼‰ã®2ç¨®é¡ãŒã‚ã‚Šã¾ã™ã€‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯Accurateã§èªè­˜ã•ã‚Œã‚‹ãŸã‚ã€ä»¥é™ã¯ãã®å‰æã§èª¬æ˜ã‚’ç¶šã‘ã¾ã™ã€‚

> VNRecognizeTextRequest uses the accurate path by default. To select the fast path, set the requestâ€™s recognitionLevel property to VNRequestTextRecognitionLevel.fast.
> 
> å¼•ç”¨å…ƒ https://developer.apple.com/documentation/vision/recognizing-text-in-images

### confidenceãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®å€¤

VNRecognizedTextObservationã®confidenceãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ï¼ˆèªè­˜çµæœã®ç¢ºä¿¡åº¦ï¼‰ã®å€¤ã¯0.0ã‹ã‚‰1.0ã®ç¯„å›²ã«æ­£è¦åŒ–ã•ã‚Œã¦ã„ã¾ã™ã€‚

ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ã¯è¨˜è¼‰ã•ã‚Œã¦ã„ã¾ã›ã‚“ãŒã€confidenceã®å€¤ã¯é€£ç¶šçš„ã«å¤‰åŒ–ã™ã‚‹å€¤ã§ã¯ãªã0.1åˆ»ã¿ã®å€¤ã®ã‚ˆã†ã§ã™ã€‚ã¾ãŸã€Accurateã§è©¦ã—ãŸé™ã‚Šã€confidenceã®å€¤ã¯0.3ã€0.5ã€1.0ã®ã„ãšã‚Œã‹ã§ã—ãŸã€‚

## å‚è€ƒè³‡æ–™

1. [Vision - Apple Developer Documentation](https://developer.apple.com/documentation/vision)
2. [Original Objective-C and Swift API - Apple Developer Documentation](https://developer.apple.com/documentation/vision/original-objective-c-and-swift-api)
3. [Recognizing Text in Images - Apple Developer Documentation](https://developer.apple.com/documentation/vision/recognizing-text-in-images)

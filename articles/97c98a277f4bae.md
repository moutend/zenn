---
title: "Cloudflare Workers入門"
emoji: "🙆"
type: "tech"
topics: [Cloudflare]
published: false
---
## はじめに

この記事はCloudflare Workersの入門記事です。

## 実行環境

最新のnode.js

```console
$ node -v
v19.6.0
$ npm -v
9.4.0
$ npx -v
9.4.0
```

## サインアップ

Cloudflare Workersは無料で利用できます。クレジットカードの登録も不要です。トップページの「Sign up」からサインアップを行いましょう。

- [Cloudflare Workers®](https://workers.cloudflare.com)

### サブドメインの設定

Cloudflare WorkersはプロジェクトごとにURLとして`https://プロジェクト名.サブドメイン.workers.dev`を発行してくれます；。サブドメインは自由に設定できます。

サインアップが完了したらダッシュボードにログインしましょう。「Workers」をクリックするとサブドメインの入力が求められます。お好みのサブドメインを設定してください。

以上でCloudflare Workersを利用する準備が整いました。

## まずは「Hello, World!」

```console
$ curl https://hello.example.workers.dev
Hello, World!
```

### プロジェクトの初期化

それではプロジェクトの初期化を行いましょう。以下のコマンドを実行してください。

```console
$ npx wrangler init hello
```

初期化を行う際にいくつか質問されます。今回は以下のように答えました。

参考までに実行例を示します。初期化が成功すると`hello`ディレクトリが作成されます。

```console
$ npx wrangler init hello
 ⛅️ wrangler 2.13.0 (update available 2.14.0)
-------------------------------------------------------
Using npm as package manager.
✨ Created hello/wrangler.toml
✔ Would you like to use git to manage this Worker? … no
✔ No package.json found. Would you like to create one? … yes
✨ Created hello/package.json
✔ Would you like to use TypeScript? … yes
✨ Created hello/tsconfig.json
✔ Would you like to create a Worker at hello/src/index.ts? › Fetch handler
✨ Created hello/src/index.ts
✔ Would you like us to write your first test with Vitest? … no
(⠂⠂⠂⠂⠂⠂⠂⠂⠂⠂⠂⠂⠂⠂⠂⠂⠂⠂) ⠋ idealTree:hello: sill idealTree buildDeps
npm WARN deprecated rollup-plugin-inject@3.0.2: This package has been deprecated and is no longer maintained. Please use @rollup/plugin-inject.
npm WARN deprecated sourcemap-codec@1.4.8: Please use @jridgewell/sourcemap-codec instead

added 104 packages, and audited 105 packages in 20s

12 packages are looking for funding
  run `npm fund` for details

found 0 vulnerabilities
✨ Installed @cloudflare/workers-types and typescript into devDependencies

To start developing your Worker, run `cd hello && npm start`
To publish your Worker to the Internet, run `npm run deploy`
```

### src/index.tsを見てみよう

```ts
/**
 * Welcome to Cloudflare Workers! This is your first worker.
 *
 * - Run `wrangler dev src/index.ts` in your terminal to start a development server
 * - Open a browser tab at http://localhost:8787/ to see your worker in action
 * - Run `wrangler publish src/index.ts --name my-worker` to publish your worker
 *
 * Learn more at https://developers.cloudflare.com/workers/
 */

export interface Env {
	// Example binding to KV. Learn more at https://developers.cloudflare.com/workers/runtime-apis/kv/
	// MY_KV_NAMESPACE: KVNamespace;
	//
	// Example binding to Durable Object. Learn more at https://developers.cloudflare.com/workers/runtime-apis/durable-objects/
	// MY_DURABLE_OBJECT: DurableObjectNamespace;
	//
	// Example binding to R2. Learn more at https://developers.cloudflare.com/workers/runtime-apis/r2/
	// MY_BUCKET: R2Bucket;
	//
	// Example binding to a Service. Learn more at https://developers.cloudflare.com/workers/runtime-apis/service-bindings/
	// MY_SERVICE: Fetcher;
}

export default {
	async fetch(
		request: Request,
		env: Env,
		ctx: ExecutionContext
	): Promise<Response> {
		return new Response("Hello World!");
	},
};
```

### 試運転
### インターネット上に公開する

## cfプロパティ

## 参考資料

1. [Building a To-Do List with Workers and KV - The Cloudflare Blog](https://blog.cloudflare.com/building-a-to-do-list-with-workers-and-kv/)
[Cloudflare Workers と KV でTodoListアプリを作る](https://zenn.dev/kameoncloud/articles/7236a2c6ad35c0)
1. [CloudflareにNode.jsのAsyncLocalStorageがサポートされたので試してみた - DevelopersIO](https://dev.classmethod.jp/articles/cloudflare-workers-asynclocalstorage/)
1. [Get started guide - Cloudflare Workers docs](https://developers.cloudflare.com/workers/get-started/guide/)
2. [How Workers works - Cloudflare Workers docs](https://developers.cloudflare.com/workers/learning/how-workers-works/)
3. [Request - Cloudflare Workers docs](https://developers.cloudflare.com/workers/runtime-apis/request/)
3. [Request - Web APIs - MDN](https://developer.mozilla.org/en-US/docs/Web/API/Request)
4. [Cloudflare Global Network - Data Center Locations - Cloudflare](https://www.cloudflare.com/network/)
5. [IATA - Wikipedia](https://en.wikipedia.org/wiki/IATA_airport_code)
6. [Autonomous system - Wikipedia](https://en.wikipedia.org/wiki/Autonomous_system_(Internet))

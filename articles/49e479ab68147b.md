---
title: "（Swift）MLImageClassifierを用いてiPhone上で画像分類モデルの訓練と推論を行う"
emoji: "📝"
type: "tech"
topics: [Apple, iOS, Swift, 機械学習]
published: false
---
## はじめに

Create MLのMLImageClassifierを用いてiPhone上で画像分類モデルの訓練と推論行うサンプルアプリを作成しました。具体的な実装だけ知りたい場合は以下のリポジトリを参考にしてください。`Logic/ImageTrainer.swift`が訓練、`Logic/ImageClassifier.swift`が推論の実装になります。

https://github.com/moutend/TrainingMLImageClassifier

Mac上でモデルを作成して`.mlmodel`ファイルをプロジェクトに埋め込む例はよく見かけますが、モデルの訓練から推論までをiPhone上で完結させる例はあまり見かけません。オンデバイスな機械学習の一例として参考になれば幸いです。

## この記事で深堀する内容

ここからは実装の詳細を深掘りします。

1. 実質的にロジスティック回帰モデルしか選択肢がありません。

### （その1）実質的にロジスティック回帰モデルしか選択肢がない

ディープなニューラルネットワークで最強のモデルを作ろうとお考えの方には悲報かもしれません。現状、Create MLで画像分類に利用できるのは実質的にロジスティック回帰モデルのみです。以下、Apple Developerドキュメントから引用します。

> [MLImageClassifier.ModelParameters.ClassifierType - Apple Developer Documentation](https://developer.apple.com/documentation/createml/mlimageclassifier/modelparameters-swift.struct/classifiertype)
> 
> `case logisticRegressor` -- Logistic regression is a statistical model that classifies input feature vector into different categories.
> `case multilayerPerceptron(layerSizes: [Int])` -- Multilayer perceptron, layerSizes holds a list of positive integers that represent the number of hidden units in each layer. An additional fully connected layer with a Softmax activation output will be added that maps to probabilities of sound categories.

2つめの`multilayerPerceptron`がニューラルネットワークを利用したモデルかと思われるかもしれません。実際そうらしいのですが、説明を最後まで読むと音声を分類するため、と書かれています。

つまり、例えば画像処理でよく使われる畳み込みニューラルネットワークのようなモデルではなく、文字通りレイヤーを重ねただけの素朴なネットワークです。何にでも使えるので、とりあえず選択肢として含めてあるだけと思われます。

余談になりますが、書籍「ゼロから作るDeep Learning」では素朴な2層のニューラルネットワークを用いてMNIST画像の分類気を実装する例が登場します。

- [O'Reilly Japan - ゼロから作るDeep Learning](https://www.oreilly.co.jp/books/9784873117584/)

## 参考資料

1. [MLJob - Apple Developer Documentation](https://developer.apple.com/documentation/createml/mljob)
2. [MLImageClassifier.ModelParameters - Apple Developer Documentation](https://developer.apple.com/documentation/createml/mlimageclassifier/modelparameters-swift.struct)
3. [MLImageClassifier.FeatureExtractorType - Apple Developer Documentation](https://developer.apple.com/documentation/createml/mlimageclassifier/featureextractortype)
4. [MLImageClassifier.ModelParameters.ModelAlgorithmType - Apple Developer Documentation](https://developer.apple.com/documentation/createml/mlimageclassifier/modelparameters-swift.struct/modelalgorithmtype)
5. [iOSでのCreateML / CoreMLを用いたオンデバイス機械学習 - エニグモ開発者ブログ](https://tech.enigmo.co.jp/entry/2022/12/20/070000)

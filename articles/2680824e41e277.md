---
title: "ï¼ˆSwiftï¼‰CLIãƒ„ãƒ¼ãƒ«ã®ä½œã‚Šæ–¹"
emoji: "ğŸ•"
type: "tech"
topics: [Apple, macOS, Swift, CLI]
published: false
---
## ã¯ã˜ã‚ã«

swiftã‚³ãƒãƒ³ãƒ‰ã‚’åˆ©ç”¨ã—ã¦CLIãƒ„ãƒ¼ãƒ«ã‚’ä½œã‚‹æ–¹æ³•ã‚’èª¬æ˜ã—ã¾ã™ã€‚æ“ä½œã¯ã™ã¹ã¦ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§è¡Œã„ã¾ã™ã€‚

## ç’°å¢ƒ

ä»¥ä¸‹ã®ç’°å¢ƒã§å‹•ä½œç¢ºèªã‚’è¡Œã„ã¾ã—ãŸã€‚é€šå¸¸ã¯Xcodeã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã¨swiftã‚³ãƒãƒ³ãƒ‰ãŒåŒæ™‚ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¾ã™ã€‚

- macOS
  - Monterey 12.7.6
  - Sonoma 14.5
- Xcode
  - 14.2 (14C18)
  - 15.4 (15F31d)
- Apple Swift
  - 5.7.2
  - 5.10

## Step 1. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®åˆæœŸåŒ–

ä¾‹ã¨ã—ã¦`mytool`ã‚³ãƒãƒ³ãƒ‰ã‚’ä½œã‚‹ã“ã¨ã«ã—ã¾ã™ã€‚ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‚’é–‹ãã€æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚

```console
$ mkdir mytool
$ cd mytool
$ swift package init --type executable --name mytool
```

å®Œäº†ã™ã‚‹ã¨ã€ä»¥ä¸‹ã®ã‚ˆã†ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

```console
$ swift package init --type executable --name mytool
Creating executable package: mytool
Creating Package.swift
Creating .gitignore
Creating Sources/
Creating Sources/main.swift
```

swiftã‚³ãƒãƒ³ãƒ‰ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«ã‚ˆã£ã¦ä½œæˆã•ã‚Œã‚‹ãƒ•ã‚¡ã‚¤ãƒ«åã‚„ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®æ§‹é€ ãŒå°‘ã€…å¤‰åŒ–ã™ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚

## Step 2. ãƒ“ãƒ«ãƒ‰

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®åˆæœŸåŒ–ãŒå®Œäº†ã—ãŸæ™‚ç‚¹ã§ãƒ“ãƒ«ãƒ‰ãŒå¯èƒ½ãªçŠ¶æ…‹ã«ãªã£ã¦ã„ã¾ã™ã€‚æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚

```console
$ swift build -c release
```

å®Œäº†ã™ã‚‹ã¨ã€ä»¥ä¸‹ã®ã‚ˆã†ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

```console
$ swift build -c release
Building for production...
[5/5] Linking mytool
Build complete! (7.34s)
```

## Step 3. å®Ÿè¡Œ

ãƒ“ãƒ«ãƒ‰ãŒæˆåŠŸã™ã‚‹ã¨ã€å®Ÿè¡Œå¯èƒ½ãƒ•ã‚¡ã‚¤ãƒ«ã¯`.build/release`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ä½œæˆã•ã‚Œã¾ã™ã€‚è©¦ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```console
$ ./.build/release/mytool
Hello, World!
```

## Step 4. ã‚³ãƒ¼ãƒ‰ã®ç·¨é›†

Swiftã‚³ãƒ¼ãƒ‰ã¯`Sources`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«é…ç½®ã—ã¾ã™ã€‚ãªãŠã€ä»¥ä¸‹ã®ç‚¹ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚

### Swift 5.7ã®æ³¨æ„ç‚¹

Swift 5.10ã§ã‚ã‚Œã°è§£æ¶ˆã•ã‚Œã¦ã„ã‚‹ãŸã‚ä¸è¦ãªå ´åˆã¯èª­ã¿é£›ã°ã—ã¦ãã ã•ã„ã€‚

æ³¨æ„ç‚¹ã¨ã—ã¦ã€ãƒ•ã‚¡ã‚¤ãƒ«ã®åå‰ãŒ`main.swift`ã®å ´åˆã¯ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆã¨ã—ã¦æ‰±ã‚ã‚Œã¾ã™ã€‚å¾“ã£ã¦ã€`main.swift`ã‚³ãƒ¼ãƒ‰ã«`@main`å±æ€§ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ã¨ãƒ“ãƒ«ãƒ‰ãŒå¤±æ•—ã—ã¾ã™ã€‚

ã¾ã¨ã‚ã‚‹ã¨ã€ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆã‚’æŒ‡ç¤ºã™ã‚‹æ–¹æ³•ã¨ã—ã¦ä»¥ä¸‹ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒå¯èƒ½ã§ã™ã€‚

**mytool.swiftï¼ˆmain.swiftã§ã¯ãªã„ä»»æ„ã®Swiftãƒ•ã‚¡ã‚¤ãƒ«ï¼‰ã«`@main`å±æ€§ã‚’è¨­å®šã™ã‚‹ãƒ‘ã‚¿ãƒ¼ãƒ³**

```swift
@main
struct MyTool {
    static func main() {
        print("Hello, world!")
    }
}
```

**main.swiftã‚’åˆ©ç”¨ã™ã‚‹ãƒ‘ã‚¿ãƒ¼ãƒ³**

```swift
print("Hello, world!")
```

## Step 5. ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®è¿½åŠ 

ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³å¼•æ•°ã‚’å‡¦ç†ã™ã‚‹ãŸã‚ã€AppleãŒå…¬å¼ã«æä¾›ã—ã¦ã„ã‚‹ArgumentParserãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã«ã—ã¾ã™ã€‚ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ«ãƒ¼ãƒˆã«ã‚ã‚‹`Package.swift`ã‚’æ¬¡ã®ã‚ˆã†ã«å¤‰æ›´ã—ã¦ãã ã•ã„ã€‚

```swift
// swift-tools-version: 5.7
// The swift-tools-version declares the minimum version of Swift required to build this package.

import PackageDescription

let package = Package(
  name: "mytool",
  platforms: [
    .macOS(.v12)
  ],
  dependencies: [
    .package(url: "https://github.com/apple/swift-argument-parser.git", from: "1.2.0")
  ],
  targets: [
    // Targets are the basic building blocks of a package. A target can define a module or a test suite.
    // Targets can depend on other targets in this package, and on products in packages this package depends on.
    .executableTarget(
      name: "mytool",
      dependencies: [
        .product(name: "ArgumentParser", package: "swift-argument-parser")
      ]),
    .testTarget(
      name: "mytoolTests",
      dependencies: ["mytool"]),
  ]
)
```

ç¶šã„ã¦ã€Sourcesãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…ã®Swiftã‚³ãƒ¼ãƒ‰ã‚’æ¬¡ã®ã‚ˆã†ã«å¤‰æ›´ã—ã¾ã™ã€‚

```swift
import ArgumentParser

@main
struct MyTool: ParsableCommand {
  static var configuration = CommandConfiguration(
    commandName: "mytool",
    abstract: "Print greeting messages many times!"
  )

  @Option(name: .long, help: "Number of greetings")
  var count: Int = 5

  func run() throws {
    let count = self.count < 1 ? 1 : self.count

    for _ in 0..<count {
      print("Hello, World!")
    }
  }
}
```

ä»¥ä¸Šã§æº–å‚™ã¯å®Œäº†ã§ã™ã€‚ãƒ“ãƒ«ãƒ‰ã™ã‚‹ã«ã¯æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚

```console
$ swift build -c release
```

é€šå¸¸ã®ãƒ“ãƒ«ãƒ‰ã¨åŒã˜ã‚³ãƒãƒ³ãƒ‰ã§ã™ãŒã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒä¾å­˜ã™ã‚‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã‚’è¡Œã£ãŸå¾Œã«ãƒ“ãƒ«ãƒ‰ãŒé–‹å§‹ã•ã‚Œã¾ã™ã€‚

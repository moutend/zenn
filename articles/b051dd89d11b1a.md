---
title: "Cloudflare Workersã«Next.jsã‚¢ãƒ—ãƒªã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹"
emoji: "ğŸ’­"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [Cloudflare, Nextjs]
published: false
---
## ã¯ã˜ã‚ã«

2024å¹´9æœˆã«Workers Static Assetsæ©Ÿèƒ½ãŒãƒªãƒªãƒ¼ã‚¹ã•ã‚Œã€ãƒ•ãƒ«ã‚¹ã‚¿ãƒƒã‚¯ãªNext.jsã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒãƒ‡ãƒ—ãƒ­ã‚¤å¯èƒ½ã«ãªã‚Šã¾ã—ãŸã€‚è¨˜äº‹æŠ•ç¨¿æ™‚ç‚¹ã§ã¾ã å®Ÿé¨“çš„æ©Ÿèƒ½ã®æ‰±ã„ã§ã™ãŒã€å‹•ä½œã™ã‚‹ã‹è©¦ã—ã¦ã¿ã¾ã™ã€‚

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã™ã‚‹

ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚ãƒ‡ãƒ—ãƒ­ã‚¤ã¯å¾Œã§è¡Œã†ãŸã‚ã€ã€ŒDo you want to deploy your application?ã€ã¯Noã¨å›ç­”ã—ã¦ãã ã•ã„ã€‚

```console
npm create cloudflare@latest my-next-app -- --framework=next --experimental
```

### ï¼ˆè£œè¶³ï¼‰package.jsonã«ã¤ã„ã¦

è¨˜äº‹ã‚’æŠ•ç¨¿ã—ãŸæ™‚ç‚¹ã§ã¯ä»¥ä¸‹ã®ã‚ˆã†ãªpackage.jsonãŒç”Ÿæˆã•ã‚Œã¾ã™ã€‚Cloudflareã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ã¯package.jsonã®scriptsã‚’ä¿®æ­£ã™ã‚‹ã‚ˆã†ã«æŒ‡ç¤ºã•ã‚Œã¦ã„ã¾ã™ãŒã€ä¿®æ­£ã¯ä¸è¦ã§ã™ã€‚

```json
{
  "name": "my-next-app",
  "version": "0.1.0",
  "private": true,
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "lint": "next lint",
    "deploy": "opennextjs-cloudflare && wrangler deploy",
    "preview": "opennextjs-cloudflare && wrangler dev",
    "cf-typegen": "wrangler types --env-interface CloudflareEnv env.d.ts"
  },
  "dependencies": {
    "next": "14.2.5",
    "react": "^18",
    "react-dom": "^18"
  },
  "devDependencies": {
    "@cloudflare/workers-types": "^4.20250109.0",
    "@opennextjs/cloudflare": "^0.3.7",
    "@types/node": "^20",
    "@types/react": "^18",
    "@types/react-dom": "^18",
    "eslint": "^8",
    "eslint-config-next": "14.2.5",
    "postcss": "^8",
    "tailwindcss": "^3.4.1",
    "typescript": "^5",
    "wrangler": "^3.101.0"
  }
}
```

## ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹

ã²ã¨ã¾ãšãƒ‡ãƒ—ãƒ­ã‚¤ãŒæˆåŠŸã™ã‚‹ã‹ç¢ºèªã—ã¾ã™ã€‚ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚

```console
npm run deploy
```

è­¦å‘Šã‚„ã‚¨ãƒ©ãƒ¼ã¯ç™ºç”Ÿã›ãšãƒ‡ãƒ—ãƒ­ã‚¤ã¯æˆåŠŸã™ã‚‹ã¯ãšã§ã™ã€‚ãƒ–ãƒ©ã‚¦ã‚¶ã§`https://my-next-app.<your_name>.workers.dev`ã‚’é–‹ã„ã¦ã¿ã¦ãã ã•ã„ã€‚

:::details å®Ÿè¡Œçµæœã®ä¾‹

å‚è€ƒã¾ã§ã«å®Ÿè¡Œæ™‚ã®ãƒ­ã‚°ã‚’ç¤ºã—ã¾ã™ã€‚

```console
$ npm run deploy

> my-next-app@0.1.0 deploy
> opennextjs-cloudflare && wrangler deploy


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ OpenNext â€” Cloudflare build â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

App directory: /private/tmp/my-next-app
Next.js version : 14.2.5
OpenNext v3.3.1

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ OpenNext â€” Building Next.js app â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


> my-next-app@0.1.0 build
> next build

  â–² Next.js 14.2.5

   Creating an optimized production build ...
(node:50071) [DEP0040] DeprecationWarning: The `punycode` module is deprecated. Please use a userland alternative instead.
(Use `node --trace-deprecation ...` to show where the warning was created)
(node:50120) [DEP0040] DeprecationWarning: The `punycode` module is deprecated. Please use a userland alternative instead.
(Use `node --trace-deprecation ...` to show where the warning was created)
 âœ“ Compiled successfully
 âœ“ Linting and checking validity of types
 âœ“ Collecting page data
 âœ“ Generating static pages (5/5)
 âœ“ Collecting build traces
 âœ“ Finalizing page optimization

Route (app)                              Size     First Load JS
â”Œ â—‹ /                                    5.23 kB        92.3 kB
â”” â—‹ /_not-found                          875 B          87.9 kB
+ First Load JS shared by all            87 kB
  â”œ chunks/23-b75664ace61c0abb.js        31.5 kB
  â”œ chunks/fd9d1056-2821b0f0cabcd8bd.js  53.7 kB
  â”” other shared chunks (total)          1.85 kB


â—‹  (Static)  prerendered as static content


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ OpenNext â€” Generating bundle â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Bundling middleware function...
Bundling static assets...
Bundling cache assets...
Building server function: default...
# copyPackageTemplateFiles
âš™ï¸ Bundling the OpenNext server...

# patchWranglerDeps
# updateWebpackChunksFile
 - chunk 347.js
 - chunk 682.js
 - chunk 948.js
Applying code patches:
 - patching require
 - patching `buildId` function
 - patching `loadManifest` function
 - patching next's require
 - patching `findDir` function
 - patching `evalManifest` function
 - patching cacheHandler
 - patching 'require(this.middlewareManifestPath)'
 - patching exception bubbling
 - patching `loadInstrumentationModule` function
 - patching `patchAsyncStorage` call
 - patching `eval("require")` calls
 - patching `require.resolve` call
All 13 patches applied

Worker saved in `/private/tmp/my-next-app/.open-next/worker.js` ğŸš€

OpenNext build complete.

 â›…ï¸ wrangler 3.101.0
--------------------

ğŸŒ€ Building list of assets...
ğŸŒ€ Starting asset upload...
ğŸŒ€ Found 31 new or modified static assets to upload. Proceeding with upload...
+ /BUILD_ID
+ /_next/static/3IkHGSNZNy73_7lkbfk4L/_buildManifest.js
+ /_next/static/chunks/app/layout-cacac135ce820ae3.js
+ /next.svg
+ /_next/static/chunks/webpack-d0ceac4fb78a3613.js
+ /cnd-cgi/_next_cache/3IkHGSNZNy73_7lkbfk4L/_not-found.cache
+ /_next/static/media/26a46d62cd723877-s.woff2
+ /_next/static/media/55c55f0601d81cf3-s.woff2
+ /_next/static/media/6d93bde91c0c2823-s.woff2
+ /cnd-cgi/_next_cache/3IkHGSNZNy73_7lkbfk4L/favicon.ico.cache
+ /_next/static/chunks/fd9d1056-2821b0f0cabcd8bd.js
+ /_next/static/3IkHGSNZNy73_7lkbfk4L/_ssgManifest.js
+ /_next/static/chunks/pages/_error-1be831200e60c5c0.js
+ /_next/static/chunks/main-app-8cc085c9d52c8c97.js
+ /_next/static/chunks/app/_not-found/page-05886c10710171db.js
+ /_next/static/media/df0a9ae256c0569c-s.woff2
+ /_next/static/chunks/173-32f9ff9bdfb525b3.js
+ /_next/static/media/581909926a08bbc8-s.woff2
+ /favicon.ico
+ /_next/static/chunks/polyfills-78c92fac7aa8fdd8.js
+ /_next/static/chunks/23-b75664ace61c0abb.js
+ /_next/static/chunks/app/page-41ceab464b24ef75.js
+ /_next/static/chunks/pages/_app-6a626577ffa902a4.js
+ /vercel.svg
+ /cnd-cgi/_next_cache/3IkHGSNZNy73_7lkbfk4L/500.cache
+ /_next/static/media/97e0cb1ae144a2a9-s.woff2
+ /_next/static/css/f451d9dd0f2d5d98.css
+ /cnd-cgi/_next_cache/3IkHGSNZNy73_7lkbfk4L/index.cache
+ /_next/static/media/a34f9d1faa5f3315-s.p.woff2
+ /_next/static/chunks/main-c8553ba68b419844.js
+ /_next/static/chunks/framework-f66176bb897dc684.js
Uploaded 10 of 31 assets
Uploaded 20 of 31 assets
Uploaded 31 of 31 assets
âœ¨ Success! Uploaded 31 files (6.85 sec)

Total Upload: 5238.56 KiB / gzip: 1355.74 KiB
Worker Startup Time: 92 ms
Uploaded my-next-app (23.24 sec)
Deployed my-next-app triggers (0.90 sec)
  https://my-next-app.moutend.workers.dev
Current Version ID: 35c1e4fb-0e51-43ea-92ed-4da5154b8b41
```

:::
